@using Newtonsoft.Json;
@using System.ComponentModel;
@{
    ViewBag.Title = "Resource";
    var Res_Search = ViewBag.Res_Search; //右邊細項
    var Resources = ViewBag.Resources; //左圖
    var Resource_detail = ViewBag.Resource_detail; //只有obser有用到
    DateTime now = DateTime.Today;
    List<dynamic>
    chart_data = new List<dynamic>();

    //判斷Composition(true跑false跳出重跑其他類)
    bool isbundle = ViewBag.isbundle;

}
@section Styles{
    <link href="~/Content/datatables/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
    <link href="~/Content/FixedHeader/css/fixedHeader.bootstrap4.css" rel="stylesheet" />
    <style>
        .main-container {
            height: 90vh;
        }

        body {
            margin-top: 20px;
            background: #eee;
        }

        .timeline-centered {
            position: relative;
            margin-bottom: 30px;
        }

            .timeline-centered.timeline-sm .timeline-entry {
                margin-bottom: 20px !important;
            }

                .timeline-centered.timeline-sm .timeline-entry .timeline-entry-inner .timeline-label {
                    padding: 1em;
                    word-wrap: break-word;
                }

            .timeline-centered:before,
            .timeline-centered:after {
                content: " ";
                display: table;
            }

            .timeline-centered:after {
                clear: both;
            }

            .timeline-centered:before {
                content: '';
                position: absolute;
                display: block;
                width: 7px;
                background: #ffffff;
                left: 50%;
                top: 20px;
                bottom: 20px;
                margin-left: -4px;
            }

            .timeline-centered .timeline-entry {
                position: relative;
                width: 50%;
                float: right;
                margin-bottom: 70px;
                clear: both;
            }

                .timeline-centered .timeline-entry:before,
                .timeline-centered .timeline-entry:after {
                    content: " ";
                    display: table;
                }

                .timeline-centered .timeline-entry:after {
                    clear: both;
                }

                .timeline-centered .timeline-entry.begin {
                    margin-bottom: 0;
                }

                .timeline-centered .timeline-entry.left-aligned {
                    float: left;
                }

                    .timeline-centered .timeline-entry.left-aligned .timeline-entry-inner {
                        margin-left: 0;
                        margin-right: -28px;
                    }

                        .timeline-centered .timeline-entry.left-aligned .timeline-entry-inner .timeline-time {
                            left: auto;
                            right: -115px;
                            text-align: left;
                        }

                        .timeline-centered .timeline-entry.left-aligned .timeline-entry-inner .timeline-icon {
                            float: right;
                        }

                        .timeline-centered .timeline-entry.left-aligned .timeline-entry-inner .timeline-label {
                            margin-left: 0;
                            margin-right: 85px;
                        }

                            .timeline-centered .timeline-entry.left-aligned .timeline-entry-inner .timeline-label:after {
                                left: auto;
                                right: 0;
                                margin-left: 0;
                                margin-right: -9px;
                                -moz-transform: rotate(180deg);
                                -o-transform: rotate(180deg);
                                -webkit-transform: rotate(180deg);
                                -ms-transform: rotate(180deg);
                                transform: rotate(180deg);
                            }

                .timeline-centered .timeline-entry .timeline-entry-inner {
                    position: relative;
                    margin-left: -31px;
                }

                    .timeline-centered .timeline-entry .timeline-entry-inner:before,
                    .timeline-centered .timeline-entry .timeline-entry-inner:after {
                        content: " ";
                        display: table;
                    }

                    .timeline-centered .timeline-entry .timeline-entry-inner:after {
                        clear: both;
                    }

                    .timeline-centered .timeline-entry .timeline-entry-inner .timeline-time {
                        position: absolute;
                        left: -115px;
                        text-align: right;
                        padding: 10px;
                        -webkit-box-sizing: border-box;
                        -moz-box-sizing: border-box;
                        box-sizing: border-box;
                    }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-time > span {
                            display: block;
                        }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-time > span:first-child {
                                font-size: 18px;
                                font-weight: bold;
                            }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-time > span:last-child {
                                font-size: 14px;
                                font-weight: bold;
                            }

                    .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon {
                        background: #fff;
                        color: #999999;
                        display: block;
                        width: 60px;
                        height: 60px;
                        -webkit-background-clip: padding-box;
                        -moz-background-clip: padding-box;
                        background-clip: padding-box;
                        border-radius: 50%;
                        text-align: center;
                        border: 7px solid #ffffff;
                        line-height: 45px;
                        font-size: 15px;
                        float: left;
                    }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-primary {
                            background-color: #007bff;
                            color: #fff;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-success {
                            background-color: #28a745;
                            color: #fff;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-info {
                            background-color: #17a2b8;
                            color: #fff;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-warning {
                            background-color: #ffc107;
                            color: #fff;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-danger {
                            background-color: #dc3545;
                            color: #fff;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-red {
                            background-color: #dc3545;
                            color: #fff;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-green {
                            background-color: #28a745;
                            color: #fff;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-blue {
                            background-color: #007bff;
                            color: #fff;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-yellow {
                            background-color: #ffc107;
                            color: #fff;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-orange {
                            background-color: #fd7e14;
                            color: #fff;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-pink {
                            background-color: #e83e8c;
                            color: #fff;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-violet {
                            background-color: #9351ad;
                            color: #fff;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-grey {
                            background-color: #6c757d;
                            color: #fff;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-icon.bg-dark {
                            background-color: #343a40;
                            color: #fff;
                        }

                    .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label {
                        position: relative;
                        background: #ffffff;
                        padding: 1.7em;
                        margin-left: 85px;
                        -webkit-background-clip: padding-box;
                        -moz-background-clip: padding;
                        background-clip: padding-box;
                        -webkit-border-radius: 3px;
                        -moz-border-radius: 3px;
                        border-radius: 3px;
                    }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-red {
                            background: #dc3545;
                        }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-red:after {
                                border-color: transparent #dc3545 transparent transparent;
                            }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-red .timeline-title,
                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-red p {
                                color: #ffffff;
                            }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-green {
                            background: #28a745;
                        }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-green:after {
                                border-color: transparent #28a745 transparent transparent;
                            }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-green .timeline-title,
                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-green p {
                                color: #ffffff;
                            }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-orange {
                            background: #fd7e14;
                        }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-orange:after {
                                border-color: transparent #fd7e14 transparent transparent;
                            }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-orange .timeline-title,
                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-orange p {
                                color: #ffffff;
                            }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-yellow {
                            background: #ffc107;
                        }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-yellow:after {
                                border-color: transparent #ffc107 transparent transparent;
                            }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-yellow .timeline-title,
                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-yellow p {
                                color: #ffffff;
                            }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-blue {
                            background: #007bff;
                        }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-blue:after {
                                border-color: transparent #007bff transparent transparent;
                            }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-blue .timeline-title,
                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-blue p {
                                color: #ffffff;
                            }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-pink {
                            background: #e83e8c;
                        }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-pink:after {
                                border-color: transparent #e83e8c transparent transparent;
                            }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-pink .timeline-title,
                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-pink p {
                                color: #ffffff;
                            }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-violet {
                            background: #9351ad;
                        }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-violet:after {
                                border-color: transparent #9351ad transparent transparent;
                            }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-violet .timeline-title,
                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-violet p {
                                color: #ffffff;
                            }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-grey {
                            background: #6c757d;
                        }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-grey:after {
                                border-color: transparent #6c757d transparent transparent;
                            }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-grey .timeline-title,
                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-grey p {
                                color: #ffffff;
                            }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-dark {
                            background: #343a40;
                        }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-dark:after {
                                border-color: transparent #343a40 transparent transparent;
                            }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-dark .timeline-title,
                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label.bg-dark p {
                                color: #ffffff;
                            }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label:after {
                            content: '';
                            display: block;
                            position: absolute;
                            width: 0;
                            height: 0;
                            border-style: solid;
                            border-width: 9px 9px 9px 0;
                            border-color: transparent #ffffff transparent transparent;
                            left: 0;
                            top: 20px;
                            margin-left: -9px;
                        }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label .timeline-title,
                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label p {
                            color: #999999;
                            margin: 0;
                        }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label p + p {
                                margin-top: 15px;
                            }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label .timeline-title {
                            margin-bottom: 10px;
                            font-family: 'Oswald';
                            font-weight: bold;
                        }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label .timeline-title span {
                                -webkit-opacity: .6;
                                -moz-opacity: .6;
                                opacity: .6;
                                -ms-filter: alpha(opacity=60);
                                filter: alpha(opacity=60);
                            }

                        .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label p .timeline-img {
                            margin: 5px 10px 0 0;
                        }

                            .timeline-centered .timeline-entry .timeline-entry-inner .timeline-label p .timeline-img.pull-right {
                                margin: 5px 0 0 10px;
                            }

        /*        a.active > div.timeline-label {
                background-color: #f44236;
                border-color: #f44236;
            }*/
        #chartdiv {
            width: 100%;
            height: 300px;
        }

        .owl-carousel {
            -ms-touch-action: pan-y;
            touch-action: pan-y;
        }

        .table-responsive{
            height:600px;
            overflow-y:scroll;
        }
    </style>
}
@functions
        {
    public int Age(DateTime birthday)
    {
        DateTime now = DateTime.Today;

        int age = now.Year - birthday.Year;
        if (birthday > now.AddYears(-age)) age--;
        return age;
    }
}
@*<pre>@JsonConvert.SerializeObject(Res_Search)</pre>*@
<div id="000" class="ccd"></div>
<div class="row main-container">

    <div id="time_line" class="col-md-6 overflow-auto mh-100">
        <div class="container bootstrap snippets bootdeys">
            <div class="col-md-12">
                <article class="timeline-entry">
                    <!--<div class="timeline-entry-inner col-lg-6">
                        <select class="form-control" id="ResourceSelect" name="resource">
                            <option value="Patient">Patient</option>
                            <option value="Encounter">Encounter</option>
                            <option value="Observation">Observation</option>
                            <option value="Procedure">Procedure</option>
                            <option value="Condition">Condition</option>
                            <option value="Medication">Medication</option>
                            <option value="MedicationRequest">MedicationRequest</option>-->
                    @*
                        <option value="MedicationAdministration">MedicationAdministration</option>*@
                    <!--<option value="DiagnosticReport">DiagnosticReport</option>
                            <option value="ServiceRequest">ServiceRequest</option>
                        </select>
                    </div>-->
                </article>
                <div id="scroll" class="timeline-centered timeline-sm selediv">
                    @if (Resources.Count == 0)
                    {
                        <div class="alert alert-warning" role="alert">
                            <div class="font-weight-bold text-center" style="font-size:18px">找不到任何相關資料</div>
                        </div>
                    }
                    @{
                        foreach (var res in Resources)
                        {
                            <!-- 懶載入容器 (左圖顯示)-->
                            <div id="data-container"></div>
                            #region
                            @*if (res.resourceType == "Patient")
                            {
                                <article class="timeline-entry">
                                    <div class="timeline-entry-inner">
                                        <input id="Patient_id" value="@(res.id.ToString())" hidden="hidden" />
                                        <div class="timeline-icon bg-violet">
                                            <i class="fa fa-exclamation"></i>
                                        </div>
                                        <a href="@Url.Action(res.resourceType.ToString(), new { @id = res.id.ToString()})">
                                            <div class="timeline-label">
                                                <h4 class="timeline-title">
                                                    病歷號：
                                                    @(res?.identifier?[0]?.value?.ToString() ?? "")
                                                </h4>
                                                @{
                                                    DateTime birthday;
                                                    int age = -1;
                                                    if (res.birthDate != null)
                                                    {
                                                        birthday = DateTime.Parse(Convert.ToString(res.birthDate));
                                                        age = now.Year - birthday.Year;
                                                        if (now < birthday.AddYears(age)) { age--; }
                                                    }
                                                }
                                                <p>
                                                    FHIR ID:@(res.id)
                                                    <br>
                                                    年齡:@(age != -1 ? age.ToString() : "未知")
                                                    <br>
                                                </p>
                                            </div>
                                        </a>
                                    </div>
                                </article>
                            }*@
                            @*if (res.resourceType == "Encounter")
                            {
                                DateTime period_start = DateTime.Parse(Convert.ToString(res.period.start));
                                <article class="timeline-entry left-aligned">
                                    <div class="timeline-entry-inner">
                                        <time datetime="@res.effectiveDateTime" class="timeline-time">
                                            <span>
                                                @(period_start.TimeOfDay.TotalSeconds != 0
                                            ? period_start.ToString("tt hh:mm")
                                            : "")
                                            </span>
                                            <span>@period_start.ToString("yyyy年MM月dd日")</span>
                                        </time>
                                        <div class="timeline-icon bg-grey">
                                            <i class="fa fa-group"></i>
                                        </div>
                                        <a href="@Url.Action(res.resourceType.ToString(), new { @id = res.id.ToString()})">
                                            <div class="timeline-label bg-grey">
                                                <h4 class="timeline-title">@res.id @(res.@class.code)</h4>
                                                <p>
                                                    參照連結：@(res.type?[0]?.coding[0]?.system?.ToString())
                                                    <br>
                                                    檢驗項目代碼：@(res.type?[0]?.coding[0]?.code?.ToString())
                                                    <br>
                                                    檢驗項目名稱：@(res.type?[0]?.coding[0]?.display?.ToString())
                                                    <br>
                                                    說明：@(res.type?[0]?.text?.ToString())
                                                </p>
                                            </div>
                                        </a>
                                    </div>
                                </article>
                            }*@
                            //else if (res.resourceType == "Observation")
                            //{
                            @*DateTime effectiveDateTime = DateTime.Parse(Convert.ToString(res.effectiveDateTime ?? res.meta.lastUpdated));
                                <article class="timeline-entry left-aligned">
                                    <div class="timeline-entry-inner">
                                        <time datetime="@res.effectiveDateTime" class="timeline-time">
                                            <span>
                                                @(effectiveDateTime.TimeOfDay.TotalSeconds != 0
                                            ? effectiveDateTime.ToString("tt hh:mm")
                                            : "")
                                            </span>
                                            <span>@effectiveDateTime.ToString("yyyy年MM月dd日")</span>
                                        </time>
                                        <div class="timeline-icon bg-blue">
                                            <i class="fa fa-group"></i>
                                        </div>
                                        <a href="@Url.Action(res.resourceType.ToString(), new { @id = res.id.ToString()})">
                                            <div class="timeline-label bg-blue">
                                                <h4 class="timeline-title">檢驗檢查/觀察值</h4>
                                                <p>
                                                    參照連結：@(res.code?.coding?[0]?.system?.ToString())
                                                    <br />
                                                    檢驗項目代碼：@(res.code?.coding?[0]?.code?.ToString()) (LOINC)&nbsp;
                                                    @(res.category?[0]?.coding?[0]?.code?.ToString())(AJCC)
                                                    <br />
                                                    檢驗項目名稱：@(res.code?.coding?[0]?.display?.ToString())
                                                    <br />
                                                    說明：@(res.code?.text?.ToString())
                                                </p>
                                            </div>
                                        </a>
                                    </div>
                                </article>*@
                            //}
                            @*if (res.resourceType == "MedicationRequest")
                            {
                                DateTime authoredOn = DateTime.Parse(Convert.ToString(res.authoredOn ?? res.meta.lastUpdated));
                                <article class="timeline-entry">
                                    <div class="timeline-entry-inner">
                                        <time datetime="@res.authoredOn" class="timeline-time">
                                            <span>
                                                @(authoredOn.TimeOfDay.TotalSeconds != 0
                                                ? authoredOn.ToString("tt hh:mm")
                                                : "")
                                            </span>
                                            <span>@authoredOn.ToString("yyyy年MM月dd日")</span>
                                        </time>
                                        <div class="timeline-icon bg-red">
                                            <i class="fa fa-group"></i>
                                        </div>
                                        <a href="@Url.Action(res.resourceType.ToString(), new { @id = res.id.ToString()})">
                                            <div class="timeline-label bg-red">
                                                <h4 class="timeline-title">藥物</h4>
                                                <p style="white-space: pre-line;">
                                                    @(res.medicationCodeableConcept != null
                                ? "參照連結：" + res.medicationCodeableConcept.coding[0].system + "\n"
                                + "藥物代碼：" + res.medicationCodeableConcept.coding[0].code + "\n"
                                + "藥物名稱：" + res.medicationCodeableConcept.coding[0].display + "\n"
                                + "說明：" + res.medicationCodeableConcept.text
                                : "藥物連結：" + res.medicationReference.reference)
                                                </p>
                                            </div>
                                        </a>
                                    </div>
                                </article>
                            }*@
                            @*if (res.resourceType == "Procedure")
                            {

                                DateTime performedPeriod_start = DateTime.Parse(Convert.ToString(res.performedPeriod != null ? (res.performedPeriod.start != null ? res.performedPeriod.start : res.meta.lastUpdated) : res.meta.lastUpdated));
                                DateTime performedPeriod_end = DateTime.Parse(Convert.ToString(res.performedPeriod != null ? (res.performedPeriod.end != null ? res.performedPeriod.end : res.meta.lastUpdated) : res.meta.lastUpdated));
                                <article class="timeline-entry">
                                    <div class="timeline-entry-inner">
                                        <time datetime="@res.authoredOn" class="timeline-time">
                                            <span>
                                                @(performedPeriod_start.TimeOfDay.TotalSeconds != 0
                                                ? performedPeriod_start.ToString("tt hh:mm")
                                                : "")
                                            </span>
                                            <span>@performedPeriod_start.ToString("yyyy年MM月dd日")</span>
                                            <span>
                                                @(performedPeriod_start.TimeOfDay.TotalSeconds != 0
                                                ? performedPeriod_end.ToString("tt hh:mm")
                                                : "")
                                            </span>
                                            <span>@performedPeriod_end.ToString("yyyy年MM月dd日")</span>
                                        </time>
                                        <div class="timeline-icon bg-pink">
                                            <i class="fa fa-group"></i>
                                        </div>
                                        <a href="@Url.Action(res.resourceType.ToString(), new { @id = res.id.ToString()})">
                                            <div class="timeline-label bg-pink">
                                                <h4 class="timeline-title">處置</h4>
                                                <p>
                                                    參照連結：@(res.code?.coding?[0]?.system?.ToString() ?? "")
                                                    <br>
                                                    處置項目代碼：@(res.code?.coding?[0]?.code?.ToString() ?? "")
                                                    <br>
                                                    處置項目名稱：@(res.code?.coding?[0]?.display?.ToString() ?? "")
                                                    <br>
                                                    說明：@(res.code?.text?.ToString())
                                                </p>
                                            </div>
                                        </a>
                                    </div>
                                </article>
                            }*@
                            @*if (res.resourceType == "Condition")
                            {
                                DateTime onsetDateTime = DateTime.Parse(Convert.ToString(res.onsetDateTime ?? res.meta.lastUpdated));
                                <article class="timeline-entry left-aligned">
                                    <div class="timeline-entry-inner">
                                        <time datetime="@res.onsetDateTime" class="timeline-time">
                                            <span>
                                                @(onsetDateTime.TimeOfDay.TotalSeconds != 0
                                                ? onsetDateTime.ToString("tt hh:mm")
                                                : "")
                                            </span>
                                            <span>@onsetDateTime.ToString("yyyy年MM月dd日")</span>
                                        </time>
                                        <div class="timeline-icon bg-orange">
                                            <i class="fa fa-group"></i>
                                        </div>
                                        <a href="@Url.Action(res.resourceType.ToString(), new { @id = res.id.ToString()})">
                                            <div class="timeline-label bg-orange">
                                                <h4 class="timeline-title">診斷結果</h4>
                                                <p>
                                                    FHIR ID:@(res.id)
                                                </p>
                                                <p>
                                                    參照連結：@(res.code?.coding?[0]?.system?.ToString() )
                                                    <br>
                                                    處置項目代碼：@(res.code?.coding?[0]?.code?.ToString())
                                                    <br>
                                                    處置項目名稱：@(res.code?.coding?[0]?.display?.ToString() )
                                                    <br>
                                                    說明：@(res.code?.text?.ToString())
                                                </p>
                                                <p>
                                                    原發部位：@(res.bodySite?[0]?.text?.ToString())
                                                    <br>
                                                    診斷代碼：@(res.bodySite?[0]?.coding?[0]?.code?.ToString())
                                                    <br>
                                                </p>
                                            </div>
                                        </a>
                                    </div>
                                </article>
                            }*@
                            @*else if (res.resourceType == "DiagnosticReport")
                            {
                            DateTime effectiveDateTime = DateTime.Parse(Convert.ToString(res.effectiveDateTime ?? (res.effectivePeriod != null ? res.effectivePeriod.start : res.meta.lastUpdated)));
                            <article class="timeline-entry left-aligned">
                                <div class="timeline-entry-inner">
                                    <time datetime="@res.effectiveDateTime" class="timeline-time">
                                        @if (effectiveDateTime.TimeOfDay.TotalSeconds != 0)
                                        {
                                        <span>@effectiveDateTime.ToString("tt hh:mm")</span>
                                        }
                                        <span>@effectiveDateTime.ToString("yyyy年MM月dd日")</span>
                                    </time>
                                    <div class="timeline-icon bg-dark">
                                        <i class="fa fa-group"></i>
                                    </div>
                                    <a href="@Url.Action(res.resourceType.ToString(), new { @id = res.id.ToString()})">
                                        <div class="timeline-label bg-dark">
                                            <h4 class="timeline-title">檢驗報告</h4>
                                            @if (res.code != null)
                                            {
                                            <p>

                                                參照連結：@(res.code.coding[0].system)
                                                <br>
                                                診斷代碼：@(res.code.coding[0].code)
                                                <br>
                                                診斷名稱：@(res.code.coding[0].display)
                                                <br>
                                                說明：@(res.code.text)
                                            </p>
                                            }
                                        </div>
                                    </a>
                                </div>
                            </article>
                            }*@
                            #endregion
                        }
                    }
                </div>
            </div>
        </div>
    </div>


    <div class="col-md-6 card mb-0" style="background-color: #fff;">
        @if (Res_Search != null)
        {
            Res_Search = Res_Search[0];
            <div class="card-header">
                <h5>@(Res_Search.resourceType) (ID:@(Res_Search.id))</h5>
                @*<div class="card-header-right">
                    <div class="btn-group card-option">
                        <button type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="feather icon-more-horizontal"></i>
                        </button>
                        <ul class="list-unstyled card-option dropdown-menu dropdown-menu-right">
                            <li class="dropdown-item full-card"><a href="#!"><span><i class="feather icon-maximize"></i> maximize</span><span style="display:none"><i class="feather icon-minimize"></i> Restore</span></a></li>
                            <li class="dropdown-item minimize-card"><a href="#!"><span><i class="feather icon-minus"></i> collapse</span><span style="display:none"><i class="feather icon-plus"></i> expand</span></a></li>
                            <li class="dropdown-item reload-card"><a href="#!"><i class="feather icon-refresh-cw"></i> reload</a></li>
                            <li class="dropdown-item close-card"><a href="#!"><i class="feather icon-trash"></i> remove</a></li>
                        </ul>
                    </div>
                </div>*@
            </div>
            <div class="card-block border-bottom table-border-style">
                @*@foreach (PropertyDescriptor descriptor in TypeDescriptor.GetProperties(Res_Search))
                {
                    //if (descriptor.GetValue(Res_Search).GetType() == "") Newtonsoft.Json.Linq.JValue/Newtonsoft.Json.Linq.JObject/Newtonsoft.Json.Linq.JArray
                    @descriptor.Name @:- @descriptor.GetValue(Res_Search) [@descriptor.GetValue(Res_Search).GetType()]<br>
                }*@
                @*這邊都是右邊細項*@
                @if (Res_Search.resourceType == "Patient")
                {
                    <div class="table-responsive">
                        <table class="table">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col" colspan="3">基本資料</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">身分證/病歷號</th>
                                    <td>
                                        @(Res_Search.identifier?[0]?.value?.ToString() ?? "無")
                                        <br />
                                        @(Res_Search.identifier?[0]?.system?.ToString() ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                @*? Res_Search.name[0].text : (Res_Search.name[0].given[0].ToString() + " " + Res_Search.name[0].family.ToString()) ?? "無"*@
                                <tr>
                                    <th scope="row">姓名</th>
                                    <td>
                                        @(Res_Search.name?[0].text != null ? (Res_Search.name?[0].text ?? ($"{Res_Search.name?[0].family ?? ""}{Res_Search.name?[0].given?[0] ?? ""}")) : "無")

                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">生日</th>
                                    <td>
                                        @(Res_Search.birthDate != null ? (DateTime.Parse(Convert.ToString(Res_Search.birthDate)).ToString("yyyy年MM月dd日") + " (年齡：" + Age(DateTime.Parse(Convert.ToString(Res_Search.birthDate))) + ")") : "無")
                                        @*@if (Res_Search.birthDate != null)
                                        {
                                        DateTime birthDate = DateTime.Parse(Convert.ToString(Res_Search.birthDate));
                                        @: @birthDate.ToString("yyyy年MM月dd日") (年齡：@Age(birthDate))
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">性別</th>
                                    <td>
                                        @{
                                            string genderString = Res_Search.gender?.ToString();
                                            switch (genderString)
                                            {
                                                case "male":
                                                    @:男
                                                    break;
                                                case "female":
                                                    @:女
                                                    break;
                                                case "other":
                                                    @:其他
                                                    break;
                                                default:
                                                    @:未知
                                                    break;
                                            }
                                        }
                                        @*@if (Res_Search.gender != null)
                                        {
                                            switch (Res_Search.gender.ToString())
                                            {
                                                case "male":
                                                @:男
                                                break;
                                                case "female":
                                                @:女
                                                break;
                                                case "other":
                                                @:其他
                                                break;
                                                case "unknown":
                                                @:不知道
                                                break;
                                            }

                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">婚姻狀況</th>
                                    <td>
                                        @(Res_Search.maritalStatus?.coding?[0].display ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">生存狀態</th>
                                    <td>
                                        @{
                                            string deadString = Res_Search.deceasedBoolean?.ToString();
                                            switch (deadString)
                                            {
                                                case "False":
                                                    @:存活
                                                    break;
                                                case "True":
                                                    @:死亡
                                                    break;
                                                default:
                                                    @:未知
                                                    break;
                                            }
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">語言</th>
                                    <td>
                                        @(Res_Search.communication?[0]?.language?.coding?[0].display ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">組織</th>
                                    <td>
                                        @(Res_Search.managingOrganization?.reference ?? "無")
                                        @*@if (Res_Search.managingOrganization?.reference != null)
                                        {
                                        @Res_Search.managingOrganization.reference
                                        }*@

                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">國家</th>
                                    <td>
                                        @(Res_Search.address?[0].country ?? "無")
                                        @*@if (Res_Search.address?[0].country != null)
                                        {
                                        @Res_Search.address[0].country

                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">郵遞區號</th>
                                    <td>
                                        @(Res_Search.address?[0].postalCode ?? "無")
                                        @*@if (Res_Search.address?[0].postalCode != null)
                                        {
                                        @Res_Search.address[0].postalCode

                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">地址</th>
                                    <td>
                                        @(Res_Search.address?[0].text ?? "無")
                                        @*@if (Res_Search.address?[0].text != null)
                                        {
                                        @Res_Search.address[0].text

                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">電話</th>
                                    @*要修改*@
                                    <td>
                                        @(Res_Search.telecom?[0]?.system?.ToString() == "phone" ?
                                    (Res_Search.telecom[0].use + "\n" + Res_Search.telecom[0].value) :
                                    "無")
                                        @*@if (Res_Search.telecom?[0].value != null)
                                        {
                                        if (Res_Search.telecom[0].system == "phone")
                                        {
                                        @Res_Search.telecom[0].use
                                        <br />
                                        @Res_Search.telecom[0].value

                                        }
                                        }*@

                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">Email</th>
                                    <td>
                                        @(Res_Search.telecom?[1]?.system?.ToString() == "email" ?
                                    Res_Search.telecom[1].value : "無")
                                        @*@if (Res_Search.telecom?[1].system != null)
                                        {
                                        if (Res_Search.telecom[1].system == "email")
                                        {
                                        @Res_Search.telecom[1].value

                                        }
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                @*右邊必填的或是非必填但裡面有值必填_end*@
                            </tbody>

                        </table>
                    </div>
                }
                else if (Res_Search.resourceType == "Encounter")
                {
                    <div class="table-responsive">
                        <table class="table">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col" colspan="3">基本資料</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">就醫序號</th>
                                    <td>
                                        @(Res_Search.identifier?[0]?.value ?? "無")
                                        @*@if (Res_Search.identifier != null)
                                        {
                                        @Res_Search.identifier[0].value
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">就醫狀態</th>
                                    <td>
                                        @(Res_Search.status ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">急迫程度</th>
                                    <td>
                                        @(Res_Search.priority?.coding?[0]?.display ?? "未知")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">就醫科別代號</th>
                                    <td>
                                        @(Res_Search.serviceType?.coding?[0]?.code ?? "無")
                                        @*@if (Res_Search.serviceType != null)
                                        {
                                            if (Res_Search.serviceType.coding != null)
                                            {
                                                if (Res_Search.serviceType.coding[0].code != null)
                                                {
                                                    @Res_Search.serviceType.coding[0].code
                                                }
                                            }
                                        }
                                        else
                                        {
                                            @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">案件類別</th>
                                    <td>
                                        @if (Res_Search.type != null)
                                        {
                                            @: 總數: @Res_Search.type.Count
                                            <br />
                                            for (int n = 0; n < Res_Search.type.Count; n++)
                                            {
                                                var currentType = Res_Search.type[n];
                                                @(currentType.coding?[0].code ?? "")
                                                @(currentType.text != null ? currentType.text :"")
                                                @:&nbsp
                                                @(currentType.coding?[0].userSelected ?? "")
                                                <br />
                                            }
                                        }
                                        else
                                        {
                                            @:無
                                        }

                                        @*@if (Res_Search.type != null)
                                        {
                                        待修改如果沒有別的方法
                                        var num = Res_Search.type.Count.ToString();
                                        if (Res_Search.type.Count == 1)
                                        {
                                        if (Res_Search.type[0].coding != null)
                                        {
                                        if (Res_Search.type[0].coding[0].code != null)
                                        {
                                        @Res_Search.type[0].coding[0].code
                                        if (Res_Search.type[0].text != null)
                                        {
                                        @:(@Res_Search.type[0].text)
                                        }
                                        }
                                        }
                                        }
                                        if (Res_Search.type.Count == 2)
                                        {
                                        if (Res_Search.type[0].coding != null)
                                        {
                                        if (Res_Search.type[0].coding[0].code != null)
                                        {
                                        @Res_Search.type[0].coding[0].code
                                        if (Res_Search.type[0].text != null)
                                        {
                                        @:(@Res_Search.type[0].text)
                                        }
                                        }
                                        }
                                        if (Res_Search.type[1] != null)
                                        {
                                        if (Res_Search.type[1].coding != null)
                                        {
                                        if (Res_Search.type[1].coding[0].code != null)
                                        {
                                        @Res_Search.type[1].coding[0].code
                                        if (Res_Search.type[1].text != null)
                                        {
                                        @:(@Res_Search.type[1].text)
                                        }
                                        }
                                        }
                                        }
                                        }
                                        if (Res_Search.type.Count == 3)
                                        {
                                        if (Res_Search.type[0].coding != null)
                                        {
                                        if (Res_Search.type[0].coding[0].code != null)
                                        {
                                        @Res_Search.type[0].coding[0].code
                                        if (Res_Search.type[0].text != null)
                                        {
                                        @:(@Res_Search.type[0].text)
                                        }
                                        }
                                        }
                                        if (Res_Search.type[1] != null)
                                        {
                                        if (Res_Search.type[1].coding != null)
                                        {
                                        if (Res_Search.type[1].coding[0].code != null)
                                        {
                                        @Res_Search.type[1].coding[0].code
                                        if (Res_Search.type[1].text != null)
                                        {
                                        @:(@Res_Search.type[1].text)
                                        }
                                        }
                                        }
                                        }
                                        if (Res_Search.type[2] != null)
                                        {
                                        if (Res_Search.type[2].coding != null)
                                        {
                                        if (Res_Search.type[2].coding[0].code != null)
                                        {
                                        @Res_Search.type[2].coding[0].code
                                        if (Res_Search.type[2].text != null)
                                        {
                                        @:(@Res_Search.type[2].text)
                                        }
                                        }
                                        }
                                        }
                                        }*@
                                        @*if (Res_Search.type[0] != null)
                                        {
                                        if (Res_Search.type[0].coding != null)
                                        {
                                        if (Res_Search.type[0].coding[0].code != null)
                                        {
                                        @Res_Search.type[0].coding[0].code
                                        if (Res_Search.type[0].text != null)
                                        {
                                        @:(@Res_Search.type[0].text)
                                        }
                                        }
                                        }
                                        }
                                        else if (Res_Search.type[1] != null)
                                        {
                                        if (Res_Search.type[1].coding != null)
                                        {
                                        if (Res_Search.type[1].coding[0].code != null)
                                        {
                                        @Res_Search.type[1].coding[0].code
                                        if (Res_Search.type[1].text != null)
                                        {
                                        @:(@Res_Search.type[1].text)
                                        }
                                        }
                                        }
                                        }
                                        else if (Res_Search.type[2] != null)
                                        {
                                        if (Res_Search.type[2].coding != null)
                                        {
                                        if (Res_Search.type[2].coding[0].code != null)
                                        {
                                        @Res_Search.type[2].coding[0].code
                                        if (Res_Search.type[2].text != null)
                                        {
                                        @:(@Res_Search.type[2].text)
                                        }
                                        }
                                        }
                                        }*@
                                        @*}
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">入院方式</th>
                                    <td>
                                        @(Res_Search.@class?.code ?? "無")
                                        @*@if (Res_Search.@class != null)
                                        {
                                        if (Res_Search.@class.code != null)
                                        {
                                        @(Res_Search.@class.code)
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">就診日期</th>
                                    <td>
                                        @(Res_Search.period?.start != null ? DateTime.Parse(Convert.ToString(Res_Search.period.start)).ToString("yyyy年MM月dd日") : "無")
                                        @(Res_Search.period?.end != null ? " ~ " + DateTime.Parse(Convert.ToString(Res_Search.period.end)).ToString("yyyy年MM月dd日") : "")
                                        @*@if (Res_Search.period != null)
                                        {
                                        if (Res_Search.period.start != null)
                                        {
                                        DateTime periods = DateTime.Parse(Convert.ToString(Res_Search.period.start));
                                        @: @periods.ToString("yyyy年MM月dd日")
                                        }
                                        if (Res_Search.period.end != null)
                                        {
                                        DateTime periode = DateTime.Parse(Convert.ToString(Res_Search.period.end));
                                        @: ~ @periode.ToString("yyyy年MM月dd日")
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                @*
                                <tr>
                                    <th scope="row">轉歸代碼</th>
                                    <td>
                                        @if (Res_Search.hospitalization != null)
                                        {
                                        if (Res_Search.hospitalization.dischargeDisposition != null)
                                        {
                                        if (Res_Search.hospitalization.dischargeDisposition.coding != null)
                                        {
                                        if (Res_Search.hospitalization.dischargeDisposition.coding[0].code != null)
                                        {
                                        @Res_Search.hospitalization.dischargeDisposition.coding[0].code
                                        if (Res_Search.hospitalization.dischargeDisposition.text != null)
                                        {
                                        @:(@Res_Search.hospitalization.dischargeDisposition.text)
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }

                                        }
                                        else
                                        {
                                        @:無
                                        }
                                    </td>
                                    <td></td>
                                </tr>*@
                                <tr>
                                    <th scope="row">就診原因</th>
                                    <td>
                                        @(Res_Search.reasonCode?[0].coding?[0].code?.ToString() != null ? $"{Res_Search.reasonCode?[0].coding[0].code}\n{Res_Search.reasonCode?[0].text}" : "無")
                                        @*@(Res_Search.reasonCode?[0].coding?[0].code?.ToString() ?? (Res_Search.reasonCode?[0]?.text ?? "無"))
                                        @(Res_Search.reasonCode?[0].coding?[0].code?.ToString() + "\n" + (Res_Search.reasonCode?[0].text ?? ""))*@
                                        @*@if (Res_Search.reasonCode != null)
                                        {
                                        if (Res_Search.reasonCode[0].coding != null)
                                        {
                                        if (Res_Search.reasonCode[0].coding[0].code != null)
                                        {
                                        @Res_Search.reasonCode[0].coding[0].code
                                        if (Res_Search.reasonCode[0].text != null)
                                        {
                                        @:(@Res_Search.reasonCode[0].text)
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">飲食偏好</th>
                                    <td>
                                        @(Res_Search.dietPreference?[0]?.coding?[0].display ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">轉診轉院來源</th>
                                    <td>
                                        @(Res_Search.admission?.admitSource?.coding?[0].display ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                @*<tr>
                                    <th scope="row">待過地點</th>
                                    <td>
                                        @if (Res_Search.location != null)
                                        {
                                            for (int n = 0; n < Res_Search.location?[0]?.location?.Count; n++)
                                            {
                                                var currentType = Res_Search.diagnosis[n];
                                                @(currentType.use?.coding?[0]?.display ?? "")
                                            }
                                        }
                                        else
                                        {
                                            @: 無
                                        }
                                    </td>
                                    <td></td>
                                </tr>*@
                                <tr>
                                    <th scope="row">相關診斷</th>
                                    <td>
                                        @if (Res_Search.diagnosis != null)
                                        {
                                            for (int n = 0; n < Res_Search.diagnosis.Count; n++)
                                            {
                                                var currentType = Res_Search.diagnosis[n];
                                                @(currentType.use?.coding?[0]?.display ?? "")
                                            }
                                        }
                                        else
                                        {
                                            @: 無
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">特殊輔助器</th>
                                    <td>
                                        @(Res_Search.specialArrangement?[0]?.coding?[0].display ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                }
                else if (Res_Search.resourceType == "Observation")
                {
                    DateTime? effectiveDateTime = Res_Search.effectiveDateTime != null ? DateTime.Parse(Convert.ToString(Res_Search.effectiveDateTime)) : null;

                    /*DateTime? effectiveDateTime = null;
                    if (Res_Search.effectiveDateTime != null)
                    {
                    effectiveDateTime = DateTime.Parse(Convert.ToString(Res_Search.effectiveDateTime));
                    }*/
                    <div class="table-responsive">
                        <table class="table">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col" colspan="3">基本資料</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">檢驗項目名稱</th>
                                    <td>
                                        @(Res_Search.code?.text ?? "無")
                                        @*@if (Res_Search.code != null)
                                        {
                                        if (Res_Search.code.text != null)
                                        {
                                        @Res_Search.code.text
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@

                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">觀察狀態</th>
                                    <td>
                                        @(Res_Search.status ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">參照連結</th>
                                    <td>
                                        @(Res_Search.code?.coding?[0]?.system ?? "無")
                                        @*@if (Res_Search.code != null)
                                        {
                                        if (Res_Search.code.coding != null)
                                        {
                                        if (Res_Search.code.coding[0].system != null)
                                        {
                                        @Res_Search.code.coding[0].system
                                        }
                                        else
                                        {
                                        @:無
                                        }

                                        }
                                        else
                                        {
                                        @:無
                                        }

                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">檢驗方法</th>
                                    <td>
                                        @(Res_Search.method?.coding?[0].code != null ? $"{Res_Search.method.coding[0].code}\n{Res_Search.method.text ?? "無"}" :"無")
                                        @*@if (Res_Search.method != null)
                                        {
                                        if (Res_Search.method.coding != null)
                                        {
                                        if (Res_Search.method.coding[0].code != null)
                                        {
                                        @Res_Search.method.coding[0].code
                                        if (Res_Search.method.text != null)
                                        {
                                        @:(@Res_Search.method.text)
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }

                                        }
                                        else
                                        {
                                        @:無
                                        }

                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">檢驗項目代碼</th>
                                    <td>
                                        @(Res_Search.code?.coding?[0].code!=null ? ($"{Res_Search.code.coding[0].code}\r{Res_Search.code.text ?? null}\n" +
                                    (Res_Search.category?[0].coding?[0].code != null ? $"{Res_Search.category[0].coding[0].code}\n{Res_Search.category[0].text ?? null}" : null)) : "無")
                                        @*@if (Res_Search.code != null)
                                        {
                                        if (Res_Search.code.coding != null)
                                        {
                                        if (Res_Search.code.coding[0].code != null)
                                        {
                                        @Res_Search.code.coding[0].code
                                        if (Res_Search.code.text != null)
                                        {
                                        @:(@Res_Search.code.text)
                                        }
                                        <br>
                                        if (Res_Search.category != null)
                                        {
                                        if (Res_Search.category[0].coding != null)
                                        {
                                        if (Res_Search.category[0].coding[0].code != null)
                                        {
                                        @Res_Search.category[0].coding[0].code
                                        if (Res_Search.category[0].text != null)
                                        {

                                        @:(@Res_Search.category[0].text)
                                        <br>
                                        }
                                        <br>
                                        }

                                        }
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@

                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">檢驗值代碼</th>
                                    <td>
                                        @(Res_Search.valueCodeableConcept?.coding?[0].code != null ? (
                                    $"{Res_Search.valueCodeableConcept.coding[0].code}\r{(Res_Search.valueCodeableConcept.text ?? Res_Search.valueCodeableConcept.display)}\n" + (Res_Search.code.coding?[0].code != null ? (Res_Search.code.coding[0].code + "(LONIC)"): null)) :"無")
                                        <br />
                                        @*@if (Res_Search.valueCodeableConcept != null)
                                        {
                                        if (Res_Search.valueCodeableConcept.coding != null)
                                        {
                                        if (Res_Search.valueCodeableConcept.coding[0].code != null)
                                        {
                                        @Res_Search.valueCodeableConcept.coding[0].code
                                        if (Res_Search.code != null)
                                        {
                                        if (Res_Search.code.text != null)
                                        {
                                        if (Res_Search.code.text != null)
                                        {
                                        @:(@Res_Search.code.text)
                                        }
                                        }
                                        if (Res_Search.code.coding != null)
                                        {
                                        if (Res_Search.code.coding[0].code != null)
                                        {
                                        @: - @Res_Search.code.coding[0].code (LONIC)//要修改
                                        }
                                        }
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }

                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">檢驗部位</th>
                                    <td>
                                        @(Res_Search.bodySite?.coding?[0].display ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">檢驗值</th>
                                    <td>
                                        @(Res_Search.valueQuantity?.value != null ? $"{Res_Search.valueQuantity.value}\r{Res_Search.valueQuantity.unit ?? null}" :
                                    Res_Search.valueString?.Value != null ? $"{Res_Search.valueString.Value}\r{Res_Search.note?[0].text ?? "無"}" : "無")
                                        @*@if (Res_Search.valueQuantity != null)
                                        {
                                        if (Res_Search.valueQuantity.value != null)
                                        {
                                        @Res_Search.valueQuantity.value
                                        if (Res_Search.valueQuantity.unit != null)
                                        {
                                        @Res_Search.valueQuantity.unit
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }

                                        }
                                        else if (Res_Search.valueString != null)
                                        {
                                        @Res_Search.valueString.Value
                                        if (Res_Search.note != null)
                                        {
                                        if (Res_Search.note[0].text != null)
                                        {
                                        @Res_Search.note[0].text
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }

                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">檢驗項目</th>
                                    <td>
                                        @if (Res_Search?.valueCodeableConcept?.coding != null)
                                        {
                                            for (int n = 0; n < Res_Search.valueCodeableConcept.coding.Count; n++)
                                            {
                                                var currentType = Res_Search.valueCodeableConcept.coding[n];
                                                @: @(currentType.code != null ? (currentType.system != null ? currentType.system + "\n": "") +
                                                currentType.code +  ( currentType.display ?? "" ) + "\n": "")
                                                @(currentType.text ?? "")
                                                <br />
                                            }
                                        }
                                        else
                                        {
                                            @:無
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">報告檢驗值代碼</th>
                                    <td>
                                        @if (Res_Search?.component?[0]?.valueCodeableConcept != null)
                                        {
                                            for (int n = 0; n < Res_Search.component?.Count; n++)
                                            {
                                                var currentType = Res_Search.component[n];
                                                @: @(currentType.valueCodeableConcept?.coding?[0].code != null ? (currentType.valueCodeableConcept?.coding?[0].system != null ? currentType.valueCodeableConcept?.coding?[0].system + "\n": "") +
                                                currentType.valueCodeableConcept?.coding?[0].code +  ( currentType.valueCodeableConcept?.coding?[0].display ?? "" ) + "\n": "")
                                                @(currentType.valueCodeableConcept?.coding?[0].text + "\n" ?? "")
                                                <br />
                                            }
                                        }
                                        else
                                        {
                                            @:無
                                        }
                                        @*@if (Res_Search.component != null)
                                        {
                                        if (Res_Search.component.Count == 1)
                                        {
                                        if (Res_Search.component[0].valueCodeableConcept != null)
                                        {
                                        if (Res_Search.component[0].valueCodeableConcept.coding != null)
                                        {
                                        if (Res_Search.component[0].valueCodeableConcept.coding[0].code != null)
                                        {
                                        @Res_Search.component[0].valueCodeableConcept.coding[0].code
                                        if (Res_Search.component[0].code != null)
                                        {
                                        if (Res_Search.component[0].code.text != null)
                                        {
                                        @:(@Res_Search.component[0].code.text)
                                        <br />
                                        }
                                        }

                                        }

                                        }

                                        }
                                        }
                                        if (Res_Search.component.Count == 2)
                                        {
                                        if (Res_Search.component[0].valueCodeableConcept != null)
                                        {
                                        if (Res_Search.component[0].valueCodeableConcept.coding != null)
                                        {
                                        if (Res_Search.component[0].valueCodeableConcept.coding[0].code != null)
                                        {
                                        @Res_Search.component[0].valueCodeableConcept.coding[0].code
                                        if (Res_Search.component[0].code != null)
                                        {
                                        if (Res_Search.component[0].code.text != null)
                                        {
                                        @:(@Res_Search.component[0].code.text)
                                        <br />
                                        }
                                        }

                                        }

                                        }

                                        }
                                        if (Res_Search.component[1].valueCodeableConcept != null)
                                        {
                                        if (Res_Search.component[1].valueCodeableConcept.coding != null)
                                        {
                                        if (Res_Search.component[1].valueCodeableConcept.coding[0].code != null)
                                        {
                                        @Res_Search.component[1].valueCodeableConcept.coding[0].code
                                        if (Res_Search.component[1].code != null)
                                        {
                                        if (Res_Search.component[1].code.text != null)
                                        {
                                        @:(@Res_Search.component[1].code.text)
                                        <br />
                                        }
                                        }

                                        }

                                        }

                                        }
                                        }

                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">報告檢驗值</th>
                                    <td>
                                        @(Res_Search.component?[0].valueQuantity?.value != null ?
                                    Res_Search.component[0].valueQuantity.value + "\n" + (Res_Search.component[0].code?.text ?? null) : "無" )
                                        @*@if (Res_Search.component != null)
                                        {
                                        if (Res_Search.component[0].valueQuantity != null)
                                        {
                                        if (Res_Search.component[0].valueQuantity.value != null)
                                        {
                                        @Res_Search.component[0].valueQuantity.value
                                        if (Res_Search.component[0].valueQuantity.unit != null)
                                        {
                                        @Res_Search.component[0].valueQuantity.unit
                                        if (Res_Search.component[0].code != null)
                                        {
                                        if (Res_Search.component[0].code.text != null)
                                        {
                                        @:(@Res_Search.component[0].code.text)

                                        }
                                        }

                                        }

                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }

                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">發報告日期</th>
                                    <td>
                                        @(Res_Search.effectiveDateTime != null ? DateTime.Parse(Convert.ToString(Res_Search.effectiveDateTime)).ToString("yyyy年MM月dd日") : "無")
                                        @*@if (Res_Search.effectiveDateTime != null)
                                        {
                                        DateTime effectiveDate = DateTime.Parse(Convert.ToString(Res_Search.effectiveDateTime));
                                        @: @effectiveDate.ToString("yyyy年MM月dd日")
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                @*
                                <tr>
                                    <th scope="row">輸入日期</th>
                                    <td>
                                        @if (Res_Search.issued != null)
                                        {
                                        DateTime issued = DateTime.Parse(Convert.ToString(Res_Search.issued));
                                        @: @issued.ToString("yyyy年MM月dd日")
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                    </td>
                                    <td></td>
                                </tr>*@
                                <tr>
                                    <th scope="row">報告結果代碼</th>
                                    <td>
                                        @if (Res_Search.interpretation != null)
                                        {
                                            for (int n = 0; n < Res_Search.interpretation.Count; n++)
                                            {
                                                var currentType = Res_Search.interpretation[n];
                                                @: @(currentType.coding?[0].code != null ?
                                                     currentType.coding[0].code + "\n" : "")
                                                   @(currentType.text ?? "")
                                                <br />
                                            }
                                        }
                                        else
                                        {
                                            @: 無
                                        }

                                        @*@if (Res_Search.interpretation != null)
                                        {
                                        if (Res_Search.interpretation.Count == 1)
                                        {
                                        if (Res_Search.interpretation[0].coding != null)
                                        {
                                        if (Res_Search.interpretation[0].coding[0].code != null)
                                        {
                                        @Res_Search.interpretation[0].coding[0].code
                                        if (Res_Search.interpretation[0].coding[0].text != null)
                                        {
                                        @Res_Search.interpretation[0].coding[0].text
                                        }

                                        }
                                        }
                                        }
                                        if (Res_Search.interpretation.Count == 2)
                                        {
                                        if (Res_Search.interpretation[0].coding != null)
                                        {
                                        if (Res_Search.interpretation[0].coding[0].code != null)
                                        {
                                        @Res_Search.interpretation[0].coding[0].code
                                        if (Res_Search.interpretation[0].coding[0].text != null)
                                        {
                                        @Res_Search.interpretation[0].coding[0].text
                                        }

                                        }
                                        }
                                        if (Res_Search.interpretation[1].coding != null)
                                        {
                                        if (Res_Search.interpretation[1].coding[0].code != null)
                                        {
                                        @Res_Search.interpretation[1].coding[0].code
                                        if (Res_Search.interpretation[1].coding[0].text != null)
                                        {
                                        @Res_Search.interpretation[1].coding[0].text
                                        }

                                        }
                                        }
                                        }
                                        if (Res_Search.interpretation.Count == 3)
                                        {
                                        if (Res_Search.interpretation[0].coding != null)
                                        {
                                        if (Res_Search.interpretation[0].coding[0].code != null)
                                        {
                                        @Res_Search.interpretation[0].coding[0].code
                                        if (Res_Search.interpretation[0].coding[0].text != null)
                                        {
                                        @Res_Search.interpretation[0].coding[0].text
                                        }

                                        }
                                        }
                                        if (Res_Search.interpretation[1].coding != null)
                                        {
                                        if (Res_Search.interpretation[1].coding[0].code != null)
                                        {
                                        @Res_Search.interpretation[1].coding[0].code
                                        if (Res_Search.interpretation[1].coding[0].text != null)
                                        {
                                        @Res_Search.interpretation[1].coding[0].text
                                        }

                                        }
                                        }
                                        if (Res_Search.interpretation[2].coding != null)
                                        {
                                        if (Res_Search.interpretation[2].coding[0].code != null)
                                        {
                                        @Res_Search.interpretation[2].coding[0].code
                                        if (Res_Search.interpretation[2].coding[0].text != null)
                                        {
                                        @Res_Search.interpretation[2].coding[0].text
                                        }

                                        }
                                        }
                                        }


                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">參考值上下限</th>
                                    <td>
                                        @(Res_Search.referenceRange?[0]?.text != null ? "下限: " + Res_Search.referenceRange[0].text + "\n" +(Res_Search.referenceRange?[1]?.text
                                                    != null ? "\n" + "上限: " + Res_Search.referenceRange[1].text : "") :"無")
                                        @*@if (Res_Search.referenceRange != null)
                                        {
                                        if (Res_Search.referenceRange[0].text != null)
                                        {
                                        @:下限:@Res_Search.referenceRange[0].text
                                        }
                                        if (Res_Search.referenceRange[1].text != null)
                                        {
                                        @:上限:@Res_Search.referenceRange[1].text
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">報告討論</th>
                                    <td>
                                        @(Res_Search.note?[0]?.text ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="table-responsive dataTables_scroll">
                        <table id="cutomerTable" class="display table nowrap table-striped table-hover" style="width:100%" role="grid">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col">id</th>
                                    <th scope="col">值</th>
                                    <th scope="col">單位</th>
                                    <th scope="col">紀錄時間</th>
                                    <th scope="col">查看</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var res_detail in Resource_detail)
                                {
                                    <tr>
                                        @*
                                        <td>哈囉哈囉哈囉</td>*@
                                        <td>@res_detail.id</td>
                                        <td>@(res_detail.valueQuantity != null ? res_detail.valueQuantity.value : "")</td>
                                        <td>@(res_detail.valueQuantity != null ? res_detail.valueQuantity.unit : "")</td>
                                        <td>@(res_detail.effectiveDateTime)</td>
                                        <td></td>
                                    </tr>
                                    //目前只有針對第一層數值呈現圖表
                                    if (res_detail.valueQuantity != null)
                                    {
                                        if (res_detail.effectiveDateTime != null)
                                        {
                                            chart_data.Add(new { date = DateTime.Parse(Convert.ToString(res_detail.effectiveDateTime)).ToString("yyyy-MM-dd"), value = Convert.ToSingle(res_detail.valueQuantity.value) });
                                        }
                                        @*else
                                        {
                                        @:無
                                        }*@
                                    }
                                    @*else
                                    {
                                    @:無
                                    }*@
                                }
                            </tbody>
                        </table>
                    </div>

                }
                else if (Res_Search.resourceType == "Procedure")
                {
                    DateTime? performedDateTime = (Res_Search.performedDateTime != null || Res_Search.performedPeriod != null) ? DateTime.Parse(Convert.ToString(Res_Search.performedDateTime ?? Res_Search.performedPeriod?.start)) : null;

                    /*DateTime? performedDateTime = null;
                    if (Res_Search.performedDateTime != null || Res_Search.performedPeriod != null)
                    {
                    performedDateTime = DateTime.Parse(Convert.ToString(Res_Search.performedDateTime ?? Res_Search.performedPeriod.start));
                    }*/
                    <div class="table-responsive">
                        <table class="table">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col" colspan="3">基本資料</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">處置/手術方式</th>
                                    <td>
                                        @(Res_Search.code?.coding?[0].code != null ? Res_Search.code.coding[0].code + "\r" +(Res_Search.code.text ?? null) : "無")

                                        @for (int n = 0; n < Res_Search.category?.coding?.Count; n++)
                                        {
                                            var currentType = Res_Search.category.coding[n];
                                            @(currentType.code != null ?  "\n" + currentType.code + "\r" + (currentType.display ?? null) : null)
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">處置/手術部位</th>
                                    <td>
                                        @(Res_Search.bodySite?.coding?[0].display ?? "無")
                                    </td>
                                    <td></td>
                                </tr>

                                <tr>
                                    @* ****欄位名稱跟格式不同***** *@
                                    <th scope="row">處置/手術原因</th>
                                    <td>
                                        @(Res_Search.reason?[0].concept?.text ?? "無")
                                        @*@if (Res_Search.reasonCode != null)
                                        {
                                        if (Res_Search.reasonCode[0].coding != null)
                                        {
                                        if (Res_Search.reasonCode[0].coding[0].code != null)
                                        {
                                        @Res_Search.reasonCode[0].coding[0].code
                                        if (Res_Search.reasonCode[0].text != null)
                                        {
                                        @:(@Res_Search.reasonCode[0].text)
                                        }
                                        }
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">處置/手術狀態</th>
                                    <td>
                                        @(Res_Search.status ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">處置/手術結果</th>
                                    <td>
                                        @(Res_Search.outcome?.coding?[0].code != null ? Res_Search.outcome.coding[0].code + (Res_Search.outcome.text != null ? Res_Search.outcome.text
                                    + (Res_Search.note != null ? "補充說明 :" +  Res_Search.note[0].text: null): null): "無")
                                        @*@if (Res_Search.outcome != null)
                                        {
                                        if (Res_Search.outcome.coding != null)
                                        {
                                        if (Res_Search.outcome.coding[0].code != null)
                                        {
                                        @Res_Search.outcome.coding[0].code
                                        if (Res_Search.outcome.text != null)
                                        {
                                        @:(@Res_Search.outcome.text)
                                        if (Res_Search.note != null)
                                        {
                                        @:補充說明:@Res_Search.note[0].text
                                        }
                                        }
                                        }
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">處置/手術日期</th>
                                    <td>

                                        @(performedDateTime?.ToString("yyyy年MM月dd日") ?? "無")
                                        @*@if (Res_Search.performedDateTime != null)
                                        {
                                        DateTime performedDate = DateTime.Parse(Convert.ToString(Res_Search.performedDateTime));
                                        @: @performedDate.ToString("yyyy年MM月dd日")
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">處置/手術地點</th>
                                    <td>
                                        @(Res_Search.location?.display ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">未處置/手術原因</th>
                                    <td>
                                        @*@(Res_Search.statusReason?.text ?? null)*@
                                        @(Res_Search.statusReason?[0].coding?[0].code != null ? $"{Res_Search.statusReason[0].coding[0].code} \r {Res_Search.statusReason.text ?? null}" : "無")
                                        @*@if (Res_Search.statusReason != null)
                                        {
                                            if (Res_Search.statusReason[0].coding != null)
                                            {
                                                if (Res_Search.statusReason[0].coding[0].code != null)
                                                {
                                                    @Res_Search.statusReason[0].coding[0].code
                                                    if (Res_Search.statusReason.text != null)
                                                    {
                                                        @:(@Res_Search.statusReason.text)
                                                    }
                                                }
                                            }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">手術併發症</th>
                                    <td>
                                        @(Res_Search.complication?[0].concept?.coding?[0].display ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">處置/手術設備</th>
                                    <td>
                                        @if (Res_Search.focalDevice != null)
                                        {
                                            for (int n = 0; n < Res_Search.focalDevice?.Count; n++)
                                            {
                                                var currentType = Res_Search.focalDevice[n];
                                                @(currentType.action?.coding?[0].code != null ? $"{currentType.action.coding[0].code}\r{currentType.action.text ?? null}" : "無")
                                                <br />
                                            }
                                        }
                                        else
                                        {
                                            @:無
                                        }
                                        <br />
                                        @if (Res_Search.extension != null)
                                        {
                                            var num = Res_Search.extension.Count;
                                            for (int n = 0; n < Res_Search.extension.Count; n++)
                                            {
                                                var currentType = Res_Search.extension[n];
                                                @(currentType.extension[0].valueCodeableConcept?.coding[0].code != null ? $"{currentType.extension[0].valueCodeableConcept.coding[0].code}\r{currentType.extension[0].valueCodeableConcept.text ?? null}" : "")
                                                @(currentType.extension[0].valueReference?.reference != null ? $"{currentType.extension[0].valueReference.reference}\r{currentType.extension[0].valueReference.display ?? null}" : "")
                                                if (n != 0 && n != 3)
                                                {
                                                    @(currentType.extension[1]?.valueQuantity?.value != null ? $"{currentType.extension[1].valueQuantity.value}\r{currentType.extension[1].valueQuantity?.system ?? null}" : "")
                                                    @:&nbsp
                                                    @(currentType.extension[2]?.valueUnsignedInt != null ? currentType.extension[2]?.valueUnsignedInt +"次數": "")
                                                }
                                                <br />
                                            }
                                        }
                                        else
                                        {
                                            @:無
                                        }
                                        <br /><br />

                                        @*@if (Res_Search.focalDevice != null)
                                        {
                                            if (Res_Search.focalDevice[0].action != null)
                                            {
                                            if (Res_Search.focalDevice[0].action.coding != null)
                                            {
                                            if (Res_Search.focalDevice[0].action.coding[0].code != null)
                                            {
                                            @Res_Search.focalDevice[0].action.coding[0].code
                                            if (Res_Search.focalDevice[0].action.text != nll)
                                            @:(@Res_Search.focalDevice[0].action.text)
                                            }
                                            }
                                            }
                                            }
                                            if (Res_Search.focalDevice[1].action != null)
                                            {
                                            if (Res_Search.focalDevice[1].action.coding != null)
                                            {
                                            if (Res_Search.focalDevice[1].action.coding[0].code != null)
                                            {
                                            @Res_Search.focalDevice[1].action.coding[0].code
                                            if (Res_Search.focalDevice[1].action.text != null)
                                            {
                                            @:(@Res_Search.focalDevice[1].action.text)
                                            }
                                            }
                                            }
                                            }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@

                                        @*@if (Res_Search.extension != null)
                                        {
                                            if (Res_Search.extension[0].extension != null)
                                            {
                                                if (Res_Search.extension[0].extension[0].valueCodeableConcept != null)
                                                {
                                                    if (Res_Search.extension[0].extension[0].valueCodeableConcept.coding != null)
                                                    {
                                                        if (Res_Search.extension[0].extension[0].valueCodeableConcept.coding[0].code != null)
                                                        {
                                                            @Res_Search.extension[0].extension[0].valueCodeableConcept.coding[0].code
                                                            if (Res_Search.extension[0].extension[0].valueCodeableConcept.text != null)
                                                            {
                                                                @:(@Res_Search.extension[0].extension[0].valueCodeableConcept.text)
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                            if (Res_Search.extension[1].extension != null)
                                            {
                                                if (Res_Search.extension[1].extension[0].valueReference != null)
                                                {
                                                    if (Res_Search.extension[1].extension[0].valueReference.reference != null)
                                                    {
                                                        @Res_Search.extension[1].extension[0].valueReference.reference
                                                        if (Res_Search.extension[1].extension[0].valueReference.display != null)
                                                        {
                                                            @:(@Res_Search.extension[1].extension[0].valueReference.display)
                                                        }
                                                    }
                                                }
                                                if (Res_Search.extension[1].extension[1].valueQuantity != null)
                                                {
                                                    if (Res_Search.extension[1].extension[1].valueQuantity.value != null)
                                                    {
                                                        @Res_Search.extension[1].extension[1].valueQuantity.value
                                                        if (Res_Search.extension[1].extension[1].valueQuantity.system != null)
                                                        {
                                                            @:(@Res_Search.extension[1].extension[1].valueQuantity.system)
                                                        }
                                                    }
                                                }
                                                if (Res_Search.extension[1].extension[2].valueUnsignedInt != null)
                                                {
                                                    @Res_Search.extension[1].extension[2].valueUnsignedInt @:次數
                                                }
                                            }
                                            if (Res_Search.extension[2].extension != null)
                                            {
                                                if (Res_Search.extension[2].extension[0].valueReference != null)
                                                {
                                                    if (Res_Search.extension[2].extension[0].valueReference.reference != null)
                                                    {
                                                        @Res_Search.extension[2].extension[0].valueReference.reference
                                                        if (Res_Search.extension[2].extension[0].valueReference.display != null)
                                                        {
                                                            @:(@Res_Search.extension[2].extension[0].valueReference.display)
                                                        }
                                                    }
                                                }
                                                if (Res_Search.extension[2].extension[1].valueQuantity != null)
                                                {
                                                    if (Res_Search.extension[2].extension[1].valueQuantity.value != null)
                                                    {
                                                        @Res_Search.extension[2].extension[1].valueQuantity.value
                                                        if (Res_Search.extension[2].extension[1].valueQuantity.system != null)
                                                        {
                                                            @:(@Res_Search.extension[2].extension[1].valueQuantity.system)
                                                        }
                                                    }
                                                }
                                                if (Res_Search.extension[2].extension[2].valueUnsignedInt != null)
                                                {
                                                    @Res_Search.extension[2].extension[2].valueUnsignedInt @:次數
                                                }
                                            }
                                            if (Res_Search.extension[3].extension != null)
                                            {
                                                if (Res_Search.extension[3].extension[0].valueCodeableConcept != null)
                                                {
                                                    if (Res_Search.extension[3].extension[0].valueCodeableConcept.coding != null)
                                                    {
                                                        if (Res_Search.extension[3].extension[0].valueCodeableConcept.coding[0].code != null)
                                                        {
                                                            @Res_Search.extension[3].extension[0].valueCodeableConcept.coding[0].code
                                                            if (Res_Search.extension[3].extension[0].valueCodeableConcept.text != null)
                                                            {
                                                                @:(@Res_Search.extension[3].extension[0].valueCodeableConcept.text)
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                            if (Res_Search.extension[4].extension != null)
                                            {
                                                if (Res_Search.extension[4].extension[0].valueReference != null)
                                                {
                                                    if (Res_Search.extension[4].extension[0].valueReference.reference != null)
                                                    {
                                                        @Res_Search.extension[4].extension[0].valueReference.reference
                                                        if (Res_Search.extension[4].extension[0].valueReference.display != null)
                                                        {
                                                            @:(@Res_Search.extension[4].extension[0].valueReference.display)
                                                        }
                                                    }
                                                }
                                                if (Res_Search.extension[4].extension[1].valueQuantity != null)
                                                {
                                                    if (Res_Search.extension[4].extension[1].valueQuantity.value != null)
                                                    {
                                                        @Res_Search.extension[4].extension[1].valueQuantity.value
                                                        if (Res_Search.extension[4].extension[1].valueQuantity.system != null)
                                                        {
                                                            @:(@Res_Search.extension[4].extension[1].valueQuantity.system)
                                                        }
                                                    }
                                                }
                                                if (Res_Search.extension[4].extension[2].valueUnsignedInt != null)
                                                {
                                                    @Res_Search.extension[4].extension[2].valueUnsignedInt @:次數
                                                }
                                            }
                                        }*@

                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">處置/手術紀錄時間</th>
                                    <td>
                                        @(Res_Search.recorded?.ToString("yyyy年MM月dd日") ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                @*
                                <tr>
                                    <th scope="row">處置/手術設備治療日期</th>
                                    <td>
                                        @if (Res_Search.performedPeriod != null)
                                        {
                                        if (Res_Search.performedPeriod.start != null)
                                        {
                                        DateTime performedDates = DateTime.Parse(Convert.ToString(Res_Search.performedPeriod.start));
                                        @: @performedDates.ToString("yyyy年MM月dd日")
                                        }
                                        if (Res_Search.performedPeriod.end != null)
                                        {
                                        DateTime performedDatee = DateTime.Parse(Convert.ToString(Res_Search.performedPeriod.end));
                                        @: ~ @performedDatee.ToString("yyyy年MM月dd日")
                                        }

                                        }
                                        else
                                        {
                                        @:無
                                        }
                                    </td>
                                    <td></td>
                                </tr>*@
                            </tbody>

                        </table>
                    </div>
                }
                else if (Res_Search.resourceType == "Condition")
                {
                    @*DateTime? onsetDateTime = null;
                    if (Res_Search.onsetDateTime != null)
                    {
                    DateTime.Parse(Convert.ToString(Res_Search.onsetDateTime));
                    }
                    else
                    {
                    @:無
                    }*@
                    <div class="table-responsive">
                        <table class="table">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col" colspan="3">基本資料</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">疾病診斷</th>
                                    <td>
                                        @(Res_Search.code?.coding?[0].code != null ? $"{Res_Search.code.coding[0].code}\n{Res_Search.code.text ?? ""}" : "無")
                                        @*@if (Res_Search.code != null)
                                        {
                                        if (Res_Search.code.coding != null)
                                        {
                                        if (Res_Search.code.coding[0].code != null)
                                        {
                                        @Res_Search.code.coding[0].code
                                        if (Res_Search.code.text != null)
                                        {
                                        @:(@Res_Search.code.text)
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">疾病狀態</th>
                                    <td>
                                        @(Res_Search.clinicalStatus?.coding?[0]?.code ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">嚴重程度</th>
                                    <td>
                                        @(Res_Search.severity?.coding?[0]?.display ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">病發年齡</th>
                                    <td>
                                        @(Res_Search.onsetAge?.value !=null ? $"{Res_Search.onsetAge.value}\r({Res_Search.onsetAge.unit ?? ""})":"無")
                                        @*@if (Res_Search.onsetAge != null)
                                        {
                                        if (Res_Search.onsetAge.value != null)
                                        {
                                        @Res_Search.onsetAge.value
                                        if (Res_Search.onsetAge.unit != null)
                                        {
                                        @:(@Res_Search.onsetAge.unit)
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">案件分類</th>
                                    <td>
                                        @if (Res_Search.category != null)
                                        {
                                            for (int n = 0; n < Res_Search.category?.Count; n++)
                                            {
                                                var currentType = Res_Search.category[n];
                                                @(currentType.coding?[0].code != null ? $"{currentType.coding[0].code}\r{currentType.text ?? null}" : "無")
                                                <br />
                                            }
                                        }
                                        else
                                        {
                                            @:無
                                        }

                                        @*@if (Res_Search.category != null)
                                        {
                                        if (Res_Search.category.Count == 1)
                                        {
                                        if (Res_Search.category[0].coding != null)
                                        {
                                        if (Res_Search.category[0].coding[0].code != null)
                                        {
                                        @Res_Search.category[0].coding[0].code
                                        if (Res_Search.category[0].coding[0].code != null)
                                        {
                                        @:(@Res_Search.category[0].text)
                                        <br>
                                        }
                                        }
                                        }
                                        }
                                        if (Res_Search.category.Count == 2)
                                        {
                                        if (Res_Search.category[0].coding != null)
                                        {
                                        if (Res_Search.category[0].coding[0].code != null)
                                        {
                                        @Res_Search.category[0].coding[0].code
                                        if (Res_Search.category[0].coding[0].code != null)
                                        {
                                        @:(@Res_Search.category[0].text)
                                        <br>
                                        }
                                        }
                                        }
                                        if (Res_Search.category[1].coding != null)
                                        {
                                        if (Res_Search.category[1].coding[0].code != null)
                                        {
                                        @Res_Search.category[1].coding[0].code
                                        if (Res_Search.category[1].coding[0].code != null)
                                        {
                                        @:(@Res_Search.category[1].text)
                                        <br>
                                        }
                                        }
                                        }
                                        }
                                        if (Res_Search.category.Count == 3)
                                        {
                                        if (Res_Search.category[0].coding != null)
                                        {
                                        if (Res_Search.category[0].coding[0].code != null)
                                        {
                                        @Res_Search.category[0].coding[0].code
                                        if (Res_Search.category[0].coding[0].code != null)
                                        {
                                        @:(@Res_Search.category[0].text)
                                        <br>
                                        }
                                        }
                                        }
                                        if (Res_Search.category[1].coding != null)
                                        {
                                        if (Res_Search.category[1].coding[0].code != null)
                                        {
                                        @Res_Search.category[1].coding[0].code
                                        if (Res_Search.category[1].coding[0].code != null)
                                        {
                                        @:(@Res_Search.category[1].text)
                                        <br>
                                        }
                                        }
                                        }
                                        if (Res_Search.category[2].coding != null)
                                        {
                                        if (Res_Search.category[2].coding[0].code != null)
                                        {
                                        @Res_Search.category[2].coding[0].code
                                        if (Res_Search.category[2].coding[0].code != null)
                                        {
                                        @:(@Res_Search.category[2].text)
                                        <br>
                                        }
                                        }

                                        }
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">首次記錄日期</th>
                                    <td>
                                        @(Res_Search.recordedDate != null ? (DateTime.Parse(Convert.ToString(Res_Search.recordedDate)).ToString("yyyy年MM月dd日")) : "無")
                                        @*@if (Res_Search.recordedDate != null)
                                        {
                                        DateTime recordedDate = DateTime.Parse(Convert.ToString(Res_Search.recordedDate));
                                        @: @recordedDate.ToString("yyyy年MM月dd日")
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">病發部位</th>
                                    <td>
                                        @if (Res_Search.bodySite != null)
                                        {
                                            for (int n = 0; n < Res_Search.bodySite?.Count; n++)
                                            {
                                                var currentType = Res_Search.bodySite[n];
                                                @(currentType.coding?[0].code != null ? $"{currentType.coding[0].code}\r{currentType.text ?? null}" : "無")
                                                <br />
                                            }
                                        }
                                        else
                                        {
                                            @:無
                                        }

                                        @*@if (Res_Search.bodySite != null)
                                        {
                                        if (Res_Search.bodySite.Count == 1)
                                        {
                                        if (Res_Search.bodySite[0].coding != null)
                                        {
                                        if (Res_Search.bodySite[0].coding[0].code != null)
                                        {
                                        @Res_Search.bodySite[0].coding[0].code
                                        if (Res_Search.bodySite[0].text != null)
                                        {
                                        @:(@Res_Search.bodySite[0].text)
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        }
                                        if (Res_Search.bodySite.Count == 2)
                                        {
                                        if (Res_Search.bodySite[0].coding != null)
                                        {
                                        if (Res_Search.bodySite[0].coding[0].code != null)
                                        {
                                        @Res_Search.bodySite[0].coding[0].code
                                        if (Res_Search.bodySite[0].text != null)
                                        {
                                        @:(@Res_Search.bodySite[0].text)
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        if (Res_Search.bodySite[1].coding != null)
                                        {
                                        <br />if (Res_Search.bodySite[1].coding[0].code != null)
                                        {
                                        @Res_Search.bodySite[1].coding[0].code
                                        if (Res_Search.bodySite[1].text != null)
                                        {
                                        @:(@Res_Search.bodySite[1].text)
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">參照代碼</th>
                                    <td>
                                        @if (Res_Search.evidence != null)
                                        {
                                            for (int n = 0; n < Res_Search.evidence?[0].code?.Count; n++)
                                            {
                                                var currentType = Res_Search.evidence[0].code[n];
                                                @(currentType.coding?[0].code != null ? $"{currentType.coding[0].code}\r{currentType.text ?? null}" : "無")
                                                <br />
                                            }
                                        }
                                        else
                                        {
                                            @:無
                                        }


                                        @*@if (Res_Search.evidence != null)
                                        {
                                        if (Res_Search.evidence[0].code != null)
                                        {
                                        if (Res_Search.evidence[0].code.Count == 1)
                                        {
                                        if (Res_Search.evidence[0].code[0].coding != null)
                                        {
                                        if (Res_Search.evidence[0].code[0].coding[0].code != null)
                                        {
                                        @Res_Search.evidence[0].code[0].coding[0].code
                                        if (Res_Search.evidence[0].code[0].text != null)
                                        {
                                        @:(@Res_Search.evidence[0].code[0].text)
                                        }
                                        }
                                        }
                                        }
                                        if (Res_Search.evidence[0].code.Count == 2)
                                        {
                                        if (Res_Search.evidence[0].code[0].coding != null)
                                        {
                                        if (Res_Search.evidence[0].code[0].coding[0].code != null)
                                        {
                                        @Res_Search.evidence[0].code[0].coding[0].code
                                        if (Res_Search.evidence[0].code[0].text != null)
                                        {
                                        @:(@Res_Search.evidence[0].code[0].text)
                                        }
                                        }
                                        }
                                        if (Res_Search.evidence[0].code[1].coding != null)
                                        {
                                        if (Res_Search.evidence[0].code[1].coding[0].code != null)
                                        {
                                        <br />@Res_Search.evidence[0].code[1].coding[0].code
                                        if (Res_Search.evidence[0].code[1].text != null)
                                        {
                                        @:(@Res_Search.evidence[0].code[1].text)
                                        }
                                        }
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">病情階段</th>
                                    <td>
                                        @if (Res_Search.stage != null)
                                        {
                                            for (int n = 0; n < Res_Search.stage.Count; n++)
                                            {
                                                var currentType = Res_Search.stage[n];
                                                @(currentType.summary.coding?[0].code != null ? $"{currentType.summary.coding[0].code}\r{currentType.summary.text ?? null}" : "無")
                                                <br />
                                            }
                                        }
                                        else
                                        {
                                            @:無
                                        }

                                        @*@if (Res_Search.stage != null)
                                        {
                                        if (Res_Search.stage.Count == 1)
                                        {
                                        if (Res_Search.stage[0].summary != null)
                                        {
                                        if (Res_Search.stage[0].summary.coding != null)
                                        {
                                        if (Res_Search.stage[0].summary.coding[0].code != null)
                                        {
                                        @Res_Search.stage[0].summary.coding[0].code
                                        if (Res_Search.stage[0].summary.text != null)
                                        {
                                        @:(@Res_Search.stage[0].summary.text)
                                        }
                                        }
                                        }
                                        }
                                        }
                                        if (Res_Search.stage.Count == 2)
                                        {
                                        if (Res_Search.stage[0].summary != null)
                                        {
                                        if (Res_Search.stage[0].summary != null)
                                        {
                                        if (Res_Search.stage[0].summary.coding != null)
                                        {
                                        if (Res_Search.stage[0].summary.coding[0].code != null)
                                        {
                                        @Res_Search.stage[0].summary.coding[0].code
                                        if (Res_Search.stage[0].summary.text != null)
                                        {
                                        @:(@Res_Search.stage[0].summary.text)
                                        }
                                        }
                                        }
                                        }
                                        }
                                        if (Res_Search.stage[1].summary.coding != null)
                                        {
                                        if (Res_Search.stage[1].summary.coding[0].code != null)
                                        {
                                        <br>@Res_Search.stage[1].summary.coding[0].code
                                        if (Res_Search.stage[1].summary.text != null)
                                        {
                                        @:(@Res_Search.stage[1].summary.text)
                                        }
                                        }
                                        }
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">其他信息</th>
                                    <td>
                                        @(Res_Search.note?[0]?.text ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                }
                else if (Res_Search.resourceType == "MedicationRequest")
                {
                    DateTime? authoredOn = Res_Search.authoredOn != null ? DateTime.Parse(Convert.ToString(Res_Search.authoredOn)) : null;

                    DateTime? validityPeriod_start = DateTime.Parse(Convert.ToString(Res_Search.dispenseRequest.validityPeriod.start));
                    DateTime? validityPeriod_end = DateTime.Parse(Convert.ToString(Res_Search.dispenseRequest.validityPeriod.end));

                    /*DateTime? authoredOn = null;
                    if (Res_Search.authoredOn != null)
                    {
                    DateTime.Parse(Convert.ToString(Res_Search.authoredOn));
                    }*/
                    <div class="table-responsive">
                        <table class="table">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col" colspan="3">基本資料</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">用藥序號</th>
                                    <td>
                                        @(Res_Search.identifier?[0].value ?? "無")
                                        @*@if (Res_Search.identifier != null)
                                        {
                                        if (Res_Search.identifier[0].value != null)
                                        {
                                        @Res_Search.identifier[0].value
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                        <br>
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">醫令類型</th>
                                    <td>
                                        @if (Res_Search.category != null)
                                        {
                                            for (int n = 0; n < Res_Search.category.Count; n++)
                                            {
                                                var currentType = Res_Search.category[n];
                                                @: @(currentType.coding?[0].code != null ?
                                                currentType.coding[0].code + (currentType.text ?? "") : "")
                                                <br />
                                            }
                                        }
                                        else
                                        {
                                            @: 無
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">科別</th>
                                    <td>
                                        @(Res_Search.performerType?.coding?[0]?.code ?? "無")
                                        @(Res_Search.performerType?.text ?? "")
                                    </td>
                                    <td></td>
                                </tr>

                                <tr>
                                    <th scope="row">醫令代碼</th>
                                    <td>
                                        @(Res_Search.medicationCodeableConcept?.coding?[0]?.code ?? "無")
                                    </td>
                                    <td></td>
                                </tr>

                                <tr>
                                    <th scope="row">藥品日份</th>
                                    <td>
                                        @(Res_Search.dispenseRequest?.expectedSupplyDuration?.value != null ?
                                            $"{Res_Search.dispenseRequest.expectedSupplyDuration.value}\r({Res_Search.dispenseRequest.expectedSupplyDuration.unit})": "無")
                                    </td>
                                    <td></td>
                                </tr>

                                <tr>
                                    <th scope="row">藥品期限</th>
                                    <td>
                                        @(Res_Search.dispenseRequest?.validityPeriod != null ?
                                                validityPeriod_start?.ToString("yyyy年MM月dd日") + " ~ " + validityPeriod_end?.ToString("yyyy年MM月dd日") : "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">用藥狀態</th>
                                    <td>
                                        @(Res_Search.status ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">藥品使用頻率</th>
                                    <td>
                                        @(Res_Search.dosageInstruction?[0].timing?.code?.coding?[0].code ?? "無")
                                        @*@if (Res_Search.dosageInstruction != null)
                                        {
                                        if (Res_Search.dosageInstruction[0].timing != null)
                                        {
                                        if (Res_Search.dosageInstruction[0].timing.code != null)
                                        {
                                        if (Res_Search.dosageInstruction[0].timing.code.coding != null)
                                        {
                                        if (Res_Search.dosageInstruction[0].timing.code.coding[0].code != null)
                                        {
                                        @Res_Search.dosageInstruction[0].timing.code.coding[0].code

                                        }

                                        }

                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">給藥途徑/作用部位</th>
                                    <td>
                                        @(Res_Search.dosageInstruction != null ?
                                    $"{Res_Search.dosageInstruction?[0].route?.coding?[0].code ?? ""}\r{Res_Search.dosageInstruction?[0].site?.coding?[0].code ?? ""}" : "無")
                                        @*@if (Res_Search.dosageInstruction != null)
                                        {
                                        if (Res_Search.dosageInstruction[0].route != null)
                                        {
                                        if (Res_Search.dosageInstruction[0].route.coding[0] != null)
                                        {
                                        if (Res_Search.dosageInstruction[0].route.coding[0].code != null)
                                        {
                                        @Res_Search.dosageInstruction[0].route.coding[0].code
                                        }
                                        else
                                        {
                                        @:無
                                        }

                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        if (Res_Search.dosageInstruction[0].site != null)
                                        {
                                        if (Res_Search.dosageInstruction[0].site.coding != null)
                                        {
                                        if (Res_Search.dosageInstruction[0].site.coding[0].code != null)
                                        {
                                        @Res_Search.dosageInstruction[0].site.coding[0].code
                                        }

                                        }
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">藥品用量</th>
                                    <td>
                                        @(Res_Search.dosageInstruction?[0].doseAndRate?[0].doseQuantity?.value ?? "無")
                                        @*@if (Res_Search.dosageInstruction != null)
                                        {
                                        if (Res_Search.dosageInstruction[0].doseAndRate != null)
                                        {
                                        if (Res_Search.dosageInstruction[0].doseAndRate[0].doseQuantity != null)
                                        {
                                        if (Res_Search.dosageInstruction[0].doseAndRate[0].doseQuantity.value != null)
                                        {
                                        @Res_Search.dosageInstruction[0].doseAndRate[0].doseQuantity.value
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">藥品總量</th>
                                    <td>
                                        @(Res_Search.dispenseRequest?.quantity?.value ?? "無")
                                    </td>
                                    <td></td>
                                </tr>


                                <tr>
                                    <th scope="row">用藥原因</th>
                                    <td>
                                        @(Res_Search.reasonCode?[0]?.coding?[0].code != null ? Res_Search.reasonCode[0].coding[0].code
                                                +"\r" + (Res_Search.reasonCode[0].text ?? "") : "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">藥品項目代號</th>
                                    <td>
                                        @(Res_Search.medicationCodeableConcept?.coding?[0].code ?? "無")
                                        @*@if (Res_Search.medicationCodeableConcept != null)
                                        {
                                        if (Res_Search.medicationCodeableConcept.coding != null)
                                        {
                                        if (Res_Search.medicationCodeableConcept.coding[0].code != null)
                                        {
                                        @Res_Search.medicationCodeableConcept.coding[0].code
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }*@
                                    </td>
                                    <td></td>
                                </tr>
                                @if (Res_Search.dispenseRequest != null)
                                {
                                    if (Res_Search.dispenseRequest?.validityPeriod != null)
                                    {
                                        <tr>
                                            @{
                                                <th scope="row">處方服用時間</th>
                                                <td>
                                                    @(validityPeriod_start != null ?
                                    validityPeriod_start?.ToString("yyyy年MM月dd日") + (validityPeriod_start?.TimeOfDay.TotalSeconds != 0 ? validityPeriod_start?.ToString("tt hh:mm") : null) : "無")
                                                    @*@if (validityPeriod_start != null)
                                                    {
                                                    @validityPeriod_start.ToString("yyyy年MM月dd日")
                                                    if (validityPeriod_start.TimeOfDay.TotalSeconds != 0)
                                                    {
                                                    @validityPeriod_start.ToString("tt hh:mm")
                                                    }
                                                    }
                                                    else
                                                    {
                                                    @:無
                                                    }*@

                                                    ~
                                                    @(validityPeriod_end != null ?
                                    validityPeriod_end?.ToString("yyyy年MM月dd日") + (validityPeriod_end?.TimeOfDay.TotalSeconds != 0 ? validityPeriod_end?.ToString("tt hh:mm") : null) : "無")
                                                    @*@if (validityPeriod_end != null)
                                                    {
                                                    @validityPeriod_end.ToString("yyyy年MM月dd日")
                                                    if (validityPeriod_end.TimeOfDay.TotalSeconds != 0)
                                                    {
                                                    @validityPeriod_end.ToString("tt hh:mm")
                                                    }
                                                    }
                                                    else
                                                    {
                                                    @:無
                                                    }*@
                                                </td>
                                                <td></td>
                                            }
                                        </tr>
                                    }
                                    <tr>
                                        <th scope="row">每次劑量</th>
                                        <td>
                                            @Res_Search.dispenseRequest.quantity.value @Res_Search.dispenseRequest.quantity.unit
                                        </td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">服用天數</th>
                                        <td>
                                            @(Res_Search.dispenseRequest.expectedSupplyDuration != null ?
                                    $"{Res_Search.dispenseRequest.expectedSupplyDuration.value}\r{Res_Search.dispenseRequest.expectedSupplyDuration.unit}":"無")
                                            @*@{

                                            if (@Res_Search.dispenseRequest.expectedSupplyDuration == null)
                                            {

                                            @:無
                                            @:無

                                            }

                                            else
                                            {
                                            @Res_Search.dispenseRequest.expectedSupplyDuration.value @Res_Search.dispenseRequest.expectedSupplyDuration.unit
                                            }
                                            }*@

                                        </td>
                                        <td></td>
                                    </tr>
                                }
                                else
                                {
                                    @:無
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else if (Res_Search.resourceType == "Composition")
                {
                    DateTime? recorddate = Res_Search.date != null ? DateTime.Parse(Convert.ToString(Res_Search.date)) : null;
                    <div class="table-responsive">
                        <table class="table">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col" colspan="3">基本資料</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">臨床序號</th>
                                    <td>
                                        @(Res_Search.identifier?.value ?? "無")
                                        <br>
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">臨床狀態</th>
                                    <td>
                                        @(Res_Search.status ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">臨床主題</th>
                                    <td>
                                        @(Res_Search.title ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">類型代碼</th>
                                    <td>
                                        @(Res_Search.type?.coding?[0]?.code ?? "無")
                                        <br />
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">文檔類型</th>
                                    <td>
                                        @(Res_Search.type?.coding?[0]?.display ?? "無")
                                        <br />
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">分類代碼</th>
                                    <td>
                                        @(Res_Search.category?[0]?.coding?[0]?.code ?? "無")
                                        <br />
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">分類</th>
                                    <td>
                                        @(Res_Search.category?[0]?.coding?[0]?.display ?? "無")
                                        <br />
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">紀錄對象</th>
                                    <td>
                                        @(Res_Search.subject?.reference ?? "無")
                                        <br />
                                        @(Res_Search.subject?.display ?? "")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">撰寫者</th>
                                    <td>
                                        @(Res_Search.author?[0]?.reference ?? "無")
                                        <br />
                                        @(Res_Search.author?[0]?.display ?? "")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">紀錄日期</th>
                                    <td>
                                        @(Res_Search.date != null ? DateTime.Parse(Convert.ToString(Res_Search.date)).ToString("yyyy年MM月dd日") : "無")
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">就診案件</th>
                                    <td>
                                        @(Res_Search.encounter?.reference ?? "無")
                                    </td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                        <table class="table">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col" colspan="3">相關資料</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Res_Search?.section != null)
                                {
                                    foreach (var n in Res_Search.section)
                                    {
                                        <tr>
                                            <td>
                                                <table class="text-left">
                                                    <tr>
                                                        <th>
                                                            主題
                                                        </th>
                                                        <td>
                                                            @(n.title ?? "無")
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th>
                                                            連結
                                                        </th>
                                                        <td>
                                                            @if (n.entry != null)
                                                            {
                                                                foreach (var num in n.entry)
                                                                {
                                                                    @(num.reference ?? "")<br />
                                                                }
                                                            }
                                                            else
                                                            {
                                                                @:無
                                                            }
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th>
                                                            分類代碼
                                                        </th>
                                                        <td>
                                                            @(n.code?.coding?[0]?.code  ?? "無")
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th>
                                                            說明
                                                        </th>
                                                        <td>
                                                            @(n.code?.coding?[0]?.display ?? "無")
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th>
                                                            參考網站
                                                        </th>
                                                        <td>
                                                            @(n.code?.coding?[0]?.system ?? "無")
                                                        </td>
                                                    </tr>
                                                    @if (n?.section != null)
                                                    {
                                                        foreach (var info in n.section)
                                                        {
                                                            <tr>
                                                                <th>
                                                                    相關標題
                                                                </th>
                                                                <td>
                                                                    @(info?.title ?? "無")
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <th>
                                                                    排序類別
                                                                </th>
                                                                <td>
                                                                    <span>@(info?.orderedBy?.coding?[0]?.code ?? "無")</span>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <th>
                                                                    排序說明
                                                                </th>
                                                                <td>
                                                                    <span>@(info?.orderedBy?.coding?[0]?.display ?? "無")</span>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <th>
                                                                    相關連結
                                                                </th>
                                                                <td>
                                                                    @if (info?.entry != null)
                                                                    {
                                                                        foreach (var num in info.entry)
                                                                        {
                                                                            @(num.reference ?? "")<br />
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        @:無
                                                                    }
                                                                </td>
                                                            </tr>
                                                        }

                                                    }
                                                </table>
                                            </td>
                                        </tr>
                                    }
                                }

                            </tbody>
                        </table>


                    </div>
                }
                @{ #region
                    @*else if (Res_Search.resourceType == "DiagnosticReport")
                    {
                    DateTime effectiveDateTime = DateTime.Parse(Convert.ToString(Res_Search.effectiveDateTime));
                    <div class="table-responsive">
                        <table class="table">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col" colspan="3">基本資料</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">診斷</th>
                                    <td>
                                        @if (Res_Search.code.coding != null)
                                        {
                                        @Res_Search.code.coding[0].display
                                        <br>
                                        @:說明:@Res_Search.code.text
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">日期</th>
                                    <td>
                                        @effectiveDateTime.ToString("yyyy年MM月dd日")
                                        @if (effectiveDateTime.TimeOfDay.TotalSeconds != 0)
                                        {
                                        @effectiveDateTime.ToString("tt hh:mm")
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">報告書產出者</th>
                                    <td>
                                        @if (Res_Search.performer != null)
                                        {
                                        @Res_Search.performer[0].display
                                        @:(@Res_Search.performer[0].reference.ToString().Split('/')[0] ID: @(Res_Search.performer[0].reference.ToString().Split('/')[1]))
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">結果</th>
                                    <td>
                                        @if (Res_Search.result != null)
                                        {
                                        foreach (var result in Res_Search.result)
                                        {
                                        @result.display
                                        @:(檢查紀錄 ID: @(result.reference.ToString().Split('/')[1]))
                                        <br>
                                        }
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                    }
                    else if (Res_Search.resourceType == "ServiceRequest")
                    {
                    DateTime? occurrenceDateTime = null;
                    if (Res_Search.occurrenceDateTime != null)
                    {
                    DateTime.Parse(Convert.ToString(Res_Search.occurrenceDateTime));
                    }
                    <div class="table-responsive">
                        <table class="table">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col" colspan="3">基本資料</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">服務請求代碼</th>
                                    <td>
                                        @if (Res_Search.code.coding != null)
                                        {
                                        @Res_Search.code.coding[0].display
                                        <br>
                                        @:說明:@Res_Search.code.text
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">日期</th>
                                    <td>
                                        @occurrenceDateTime.Value.ToString("yyyy年MM月dd日")
                                        @if (occurrenceDateTime.Value.TimeOfDay.TotalSeconds != 0)
                                        {
                                        @occurrenceDateTime.Value.ToString("tt hh:mm")
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">就醫序號</th>
                                    <td>
                                        @if (Res_Search.encounter != null)
                                        {
                                        if (Res_Search.encounter[0].display != null)
                                        {
                                        @Res_Search.encounter[0].display
                                        }
                                        @:(@Res_Search.encounter[0].reference.ToString().Split('/')[0] ID: @(Res_Search.encounter[0].reference.ToString().Split('/')[1]))
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">患者</th>
                                    <td>
                                        @if (Res_Search.subject != null)
                                        {
                                        if (Res_Search.subject.display != null)
                                        {
                                        @Res_Search.subject.display
                                        }
                                        @:(@Res_Search.subject.reference.ToString().Split('/')[0] ID: @(Res_Search.subject.reference.ToString().Split('/')[1]))
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th scope="row">申請者</th>
                                    <td>
                                        @if (Res_Search.performer != null)
                                        {
                                        @Res_Search.performer[0].display
                                        @:(@Res_Search.performer[0].reference.ToString().Split('/')[0] ID: @(Res_Search.performer[0].reference.ToString().Split('/')[1]))
                                        }
                                        else
                                        {
                                        @:無
                                        }
                                    </td>
                                    <td></td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                    }*@
                    #endregion}
            </div>
            <div class="card-block">
                <div id="chartdiv"></div>
            </div>
        }

    </div>
</div>


@section scripts {
    <script src="~/Scripts/datatables/jquery.dataTables.min.js"></script>
    <script src="~/Scripts/datatables/dataTables.bootstrap4.min.js"></script>
    <script src="~/Scripts/FixedHeader/js/dataTables.fixedHeader.min.js"></script>
    <script src="~/Content/assets/plugins/amchart/js/index.js"></script>
    <script src="~/Content/assets/plugins/amchart/js/xy.js"></script>
    <script src="~/Content/assets/plugins/amchart/js/themes/Animated.js"></script>

    @*Mustache.js 模板*@
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
    <!-- Mustache.js 模板 -左方顯示 -->
    <script id="data-template" type="text/template">
        {{#Patient}}
        <article class="timeline-entry">
            <div class="timeline-entry-inner">
                <input id="Patient_id" value="{{id}}" hidden="hidden" />
                <div class="timeline-icon bg-violet">
                    <i id="PatFirst" class="fa fa-exclamation"></i>
                </div>
                @*<a href="/Resource/{{resourceType}}/{{id}}">*@
                <a href="/Resource/?res={{resourceType}}&id={{id}}&sele=null&isbundle=@isbundle">
                    <div class="timeline-label">
                        <h4 class="timeline-title">
                            病歷號：
                            {{identifier[0].value}}
                        </h4>
                        <p>
                            FHIR ID: {{id}}
                            <br>
                            年齡: {{birthDate}}
                            <br>
                        </p>
                    </div>
                </a>
            </div>
        </article>
        {{/Patient}}
        {{#Observation}}
        <article class="timeline-entry left-aligned">
            <div class="timeline-entry-inner">
                <time datetime="{{effectiveDateTime}}" class="timeline-time">
                    <span>
                        {{effectiveDateTime1}}
                    </span>
                    <span>{{effectiveDateYear}}</span>
                </time>
                <div class="timeline-icon bg-blue">
                    <i class="fa fa-group"></i>
                </div>
                @*<a href="/Resource/{{resourceType}}/{{id}}">*@
                <a href="/Resource/?res={{resourceType}}&id={{id}}&sele=null&isbundle=@isbundle">
                    <div class="timeline-label bg-blue">
                        <h4 class="timeline-title">檢驗檢查/觀察值</h4>
                        <p>
                            {{id}}
                        </p>
                        <p>
                            參照連結：{{code.coding.0.system}}
                            <br />
                            檢驗項目代碼：{{code.coding.0.code}}  (LOINC)&nbsp;{{category.coding.0.code}}(AJCC)
                            <br />
                            檢驗項目名稱：{{code.coding.0.display}}
                            <br />
                            說明：{{code.text}}
                        </p>
                    </div>
                </a>
            </div>
        </article>
        {{/Observation}}
        {{#Encounter}}
        <article class="timeline-entry left-aligned">
            <div class="timeline-entry-inner">
                <time datetime="{{effectiveDateTime}}" class="timeline-time">
                    <span>
                        {{period_start}}
                    </span>
                    <span>{{period_startYear}}</span>
                </time>
                <div class="timeline-icon bg-grey">
                    <i class="fa fa-group"></i>
                </div>
                @*<a href="/Resource/{{resourceType}}/{{id}}">*@
                <a href="/Resource/?res={{resourceType}}&id={{id}}&sele=null&isbundle=@isbundle">
                    <div class="timeline-label bg-grey">
                        <h4 class="timeline-title">{{id}} {{class.code}}</h4>
                        <p>
                            參照連結：{{type[0].coding[0].system}}
                            <br>
                            檢驗項目代碼：{{type[0].coding[0].code?}}
                            <br>
                            檢驗項目名稱：{{type[0].coding[0].display?}}
                            <br>
                            說明：{{type[0].text}}
                        </p>
                    </div>
                </a>
            </div>
        </article>
        {{/Encounter}}
        {{#MedicationRequest}}
        <article class="timeline-entry">
            <div class="timeline-entry-inner">
                <time datetime="{{authoredOn}}" class="timeline-time">
                    <span>
                        {{authoredOntime}}
                    </span>
                    <span>{{authoredOnYear}}</span>
                </time>
                <div class="timeline-icon bg-red">
                    <i class="fa fa-group"></i>
                </div>
                @*<a href="/Resource/{{resourceType}}/{{id}}">*@
                <a href="/Resource/?res={{resourceType}}&id={{id}}&sele=null&isbundle=@isbundle">
                    <div class="timeline-label bg-red">
                        <h4 class="timeline-title">藥物</h4>
                        <p>
                            {{id}}
                        </p>
                        <p style="white-space: pre-line;">
                            參照連結: {{medicationCodeableConcept.coding.0.system}}
                            <br />
                            藥物代碼: {{medicationCodeableConcept.coding.0.code}}
                            <br />
                            藥物名稱: {{medicationCodeableConcept.coding.0.display}}
                            <br />
                            說明: {{medicationCodeableConcept.text}}
                            <br />
                            藥物連結: {{medicationReference.reference}}
                        </p>
                    </div>
                </a>
            </div>
        </article>
        {{/MedicationRequest}}
        {{#Procedure}}
        <article class="timeline-entry">
            <div class="timeline-entry-inner">
                <time datetime="{{authoredOn}}" class="timeline-time">
                    <span>
                        {{performedPeriod_startTime}}
                    </span>
                    <span>{{performedPeriod_startYear}}</span>
                    <span>
                        {{performedPeriod_endTime}}
                    </span>
                    <span>{{performedPeriod_endYear}}</span>
                </time>
                <div class="timeline-icon bg-pink">
                    <i class="fa fa-group"></i>
                </div>
                @*<a href="/Resource/{{resourceType}}/{{id}}">*@
                <a href="/Resource/?res={{resourceType}}&id={{id}}&sele=null&isbundle=@isbundle">
                    <div class="timeline-label bg-pink">
                        <h4 class="timeline-title">處置</h4>
                        <p>
                            {{id}}
                        </p>
                        <p>
                            參照連結：{{code.coding.0.system}}
                            <br>
                            處置項目代碼：{{code.coding.0.code}}
                            <br>
                            處置項目名稱：{{code.coding.0.display}}
                            <br>
                            說明：{{code.text}}
                        </p>
                    </div>
                </a>
            </div>
        </article>
        {{/Procedure}}
        {{#Condition}}
        <article class="timeline-entry left-aligned">
            <div class="timeline-entry-inner">
                <time datetime="{{onsetDateTime}}" class="timeline-time">
                    <span>
                        {{onsetDateTimetime}}
                    </span>
                    <span>{{onsetDateTimeYear}}</span>
                </time>
                <div class="timeline-icon bg-orange">
                    <i class="fa fa-group"></i>
                </div>
                @*<a href="/Resource/{{resourceType}}/{{id}}">*@
                <a href="/Resource/?res={{resourceType}}&id={{id}}&sele=null&isbundle=@isbundle">
                    <div class="timeline-label bg-orange">
                        <h4 class="timeline-title">診斷結果</h4>
                        <p>
                            {{id}}
                        </p>
                        <p>
                            參照連結：{{code.coding.0.system}}
                            <br>
                            處置項目代碼：{{code.coding.0.code}}
                            <br>
                            處置項目名稱：{{code.coding.0.display}}
                            <br>
                            說明：{{code.text}}
                        </p>
                        <p>
                            原發部位：{{bodySite.0.text}}
                            <br>
                            診斷代碼：{{bodySite.0.coding.0.code}}
                            <br>
                        </p>
                    </div>
                </a>
            </div>
        </article>
        {{/Condition}}
        {{#Composition}}
        <article class="timeline-entry">
            <div class="timeline-entry-inner">
                <time datetime="{{date}}" class="timeline-time">
                    <span>
                        {{datetime}}
                    </span>
                    <span>{{dateYear}}</span>
                </time>
                <div class="timeline-icon bg-green">
                    <i id="CompFirst" class="fa fa-group"></i>
                </div>
                
                <a href="/Resource/?res={{resourceType}}&id={{id}}&sele=null&isbundle=@isbundle">
                    <div class="timeline-label bg-green">
                        <h4 class="timeline-title">{{id}}</h4>
                        <p>{{title}}</p>
                        <p>
                            參照連結：{{type.coding.0.system}}
                            <br>
                            臨床代碼：{{type.coding.0.code}}
                            <br>
                            臨床名稱：{{type.coding.0.display}}
                            <br>
                        </p>
                    </div>
                </a>
            </div>
        </article>
        {{/Composition}}
    </script>
    <!--<script>
        $(document).ready(function () {
            var scrollPosition = -900; // 初始滑動位置
            var batchSize = 10; // 每次載入的資料筆數

            // 從ViewBag中獲取資料
            var resourcesJson = @Html.Raw(ViewBag.ResourcesJson);
            console.log(resourcesJson);
            var segmentData = resourcesJson.filter(function (res) {
                return res.resourceType === "Observation";
            });
            //segmentData.forEach(function (res) {
            //    console.log("segmentData: " + res.code?.coding?.[0]?.code + "筆數:" + segmentData.length);
            //});

            // 滑動事件處理函式
          $("#time_line").scroll(function() {
              var currentScrollPosition  = $(this).scrollTop(); // 獲取滑動位置
              console.log("滑動位置" + currentScrollPosition)

              // 判斷是否滑動過900
              if (currentScrollPosition - scrollPosition >= 900) {
                  scrollPosition = currentScrollPosition; // 更新滑動位置

                  // 檢查是否有新的資料
                  if (segmentData.length > 0) {
                      // 取出下一批資料
                      var newData = segmentData.splice(0, batchSize);

                      // 根據資料項目逐一顯示
                      newData.forEach(function (res) {
                          console.log("顯示資料:" + res.code?.coding?.[0]?.code);

                          var effectiveDateTime = new Date(res.effectiveDateTime || res.meta.lastUpdated);

                          var dataItem = '<article id="data-item-' + res.id + '" class="timeline-entry left-aligned">' +
                              '<div class="timeline-entry-inner">' +
                              '<time datetime="' + res.effectiveDateTime + '" class="timeline-time">' +
                              '<span>' + (effectiveDateTime.getTime() !== 0 ? effectiveDateTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true }) : '') + '</span>' +
                              '<span>' + effectiveDateTime.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) + '</span>' +
                              '</time>' +
                              '<div class="timeline-icon bg-blue">' +
                              '<i class="fa fa-group"></i>' +
                              '</div>' +
                      @* '<a href="@Url.Action(res.resourceType.ToString(), new { @id = res.id.ToString()})">' +*@
                              '<div class="timeline-label bg-blue">' +
                              '<h4 class="timeline-title">檢驗檢查/觀察值</h4>' +
                              '<p>' +
                              '參照連結：' + (res.code?.coding?.[0]?.system || '') + '<br />' +
                              '檢驗項目代碼：' + (res.code?.coding?.[0]?.code || '') + ' (LOINC)&nbsp;' + (res.category?.[0]?.coding?.[0]?.code || '') + '(AJCC)<br />' +
                              '檢驗項目名稱：' + (res.code?.coding?.[0]?.display || '') + '<br />' +
                              '說明：' + (res.code?.text || '')
                              '</p>' +
                              '</div>' +
                              '</a>' +
                              '</div>' +
                              '</article>';

                          // 將資料項目添加到容器中
                          $("#data-container").append(dataItem);
                      });

                  } else {
                      // 如果沒有更多資料了，解除滑動事件綁定
                      $("#time_line").off("scroll");
                  }
              }

          });

        });
    </script>-->

<script type="text/javascript">
        //懶載入
        // 获取模板内容
        var templateContent = $("#data-template").html();

        var resourcesJson = @Html.Raw(ViewBag.ResourcesJson);
        var scrollPosition = 0; // 初始滑動位置
        var batchSize = 10; // 每次載入的資料筆數

        //var segmentData = resourcesJson.filter(function (res) {
        //    return res.resourceType === "Observation";
        //});
        console.log("總長度", resourcesJson)
        var initialData = resourcesJson.splice(0, batchSize);
        //var initialData = segmentData.splice(0, batchSize);
        var initialDataHTML = '';
        var Html = '';
        var resourcetype = '';
        var a_element = '';
        var url = '';
        var isbundle = @((bool)ViewBag.isbundle ? "true" : "false");
        var has = 0;

        //頁面跑入時預先加載的資料
        $(document).ready(function () {
            console.log("already");
            console.log("預載入:", initialData);

            //$(window).on("beforeunload", function () {
            //    return "Good Bye";


            initialData.forEach(function (res) {
                var effectiveDateTime = new Date(res.effectiveDateTime || res.meta.lastUpdated);//Observation
                var period_start = new Date(res.period?.start ?? res.meta.lastUpdated);//Encounter
                var authoredOn = new Date(res.authoredOn ?? res.meta.lastUpdated);//MedicationRequest
                var performedPeriod_start = new Date(res.performedPeriod != null ? (res.performedPeriod.start ?? res.meta?.lastUpdated) : res.meta?.lastUpdated);//Procedure
                var performedPeriod_end = new Date(res.performedPeriod != null ? (res.performedPeriod.end ?? res.meta?.lastUpdated) : res.meta?.lastUpdated);//Procedure
                if (res.resourceType === "Patient") {
                    console.log("Patient 長度:  ", res);
                    res.birthDate = AgeResult(res.birthDate);

                    initialDataHTML += Mustache.render(templateContent, { Patient: [res] });
                }
                else if (res.resourceType === "Observation") {
                    //console.log("Observation 長度:  ", res);
                    res.effectiveDateTime1 = formatDate(effectiveDateTime);
                    res.effectiveDateYear = formatDateYear(effectiveDateTime);

                    initialDataHTML += Mustache.render(templateContent, { Observation: [res] });

                }
                else if (res.resourceType === "Encounter") {
                    res.period_start = formatDate(period_start);
                    res.period_startYear = formatDateYear(period_start);

                    initialDataHTML += Mustache.render(templateContent, { Encounter: [res] });
                }
                else if (res.resourceType === "MedicationRequest") {
                    res.authoredOntime = formatDate(authoredOn);
                    res.authoredOnYear = formatDateYear(authoredOn);

                    initialDataHTML += Mustache.render(templateContent, { MedicationRequest: [res] });
                }
                else if (res.resourceType === "Procedure") {
                    res.performedPeriod_startTime = formatDate(performedPeriod_start);
                    res.performedPeriod_startYear = formatDateYear(performedPeriod_start);
                    res.performedPeriod_endTime = formatDate(performedPeriod_end);
                    res.performedPeriod_endYear = formatDateYear(performedPeriod_end);

                    initialDataHTML += Mustache.render(templateContent, { Procedure: [res] });
                }
                else if (res.resourceType === "Condition") {
                    var onsetDateTime = new Date(res.onsetDateTime ?? res.meta?.lastUpdated);
                    res.onsetDateTimetime = formatDate(onsetDateTime);
                    res.onsetDateTimeYear = formatDateYear(onsetDateTime);

                    initialDataHTML += Mustache.render(templateContent, { Condition: [res] });
                }
                else if (res.resourceType === "Composition") {
                    let date = new Date(res.date ?? res.meta?.lastUpdated);
                    res.datetime = formatDate(date);
                    res.dateYear = formatDateYear(date);

                    initialDataHTML += Mustache.render(templateContent, { Composition: [res] });
                }
            });
            $('#data-container').html(initialDataHTML);


            Composition_chang_class();

            //url = $(location).attr("pathname").split('/');
            //position = $("a[href*='" + url[3] + "']").offset()
            //console.log("123", $("a[href*='" + url[3] + "']").offset());
            //if (typeof position != "undefined") {
            //    has = 1;
            //}
            //else {
            //    has = 0;
            //}
            //setTimeout(function () {
            //    scrollToElement(position);
            //}, 1000); 這邊是自動滑動

            //ClickDiv();
            //recalculateOffset();
            TimeLableClick();//這裡

            if (localStorage.getItem('position') != null) {
                console.log("posY:" + localStorage.getItem('position'));
                $('#time_line').animate({
                    scrollTop: localStorage.getItem('position')
                });
                localStorage.removeItem('position');
            }

        });

        //滾動高度大於頁面最底部載更多資料
        $("#time_line").scroll(function () {
            var currentScrollPosition = $(this).scrollTop();
            //console.log("滑動位置" + currentScrollPosition)
            localStorage.setItem('position1', currentScrollPosition);

            // 判斷是否滑動過1000
            if (currentScrollPosition - scrollPosition >= 1000) {
                scrollPosition = currentScrollPosition; // 更新滑動位置

                // 加載更多資料
                console.log("YES");
                loadMoreData();
                //if (position === null || typeof position === "undefined") {
                //    url = $(location).attr("pathname").split('/');
                //    position = $("a[href*='" + url[3] + "']").offset()
                //    console.log("123", $("a[href*='" + url[3] + "']").offset());
                //    setTimeout(function () {
                //        scrollToElement(position);
                //    }, 1000);
                //}這邊是自動滑動

            }

            //ClickDiv();
            TimeLableClick();
        });

        function loadMoreData() {
            console.log("總長度2", resourcesJson.length);
            initialDataHTML = ''; // 重置
            initialData = resourcesJson.splice(0, batchSize);
            console.log("載入資料", initialData);
            initialData.forEach(function (res) {
                if (res.resourceType === "Observation") {
                    effectiveDateTime = new Date(res.effectiveDateTime || res.meta.lastUpdated);
                    res.effectiveDateTime1 = formatDate(effectiveDateTime);
                    res.effectiveDateYear = formatDateYear(effectiveDateTime);

                    initialDataHTML += Mustache.render(templateContent, { Observation: [res] });
                }
                else if (res.resourceType === "Encounter") {
                    var period_start = new Date(res.period?.start ?? res.meta.lastUpdated);
                    res.period_start = formatDate(period_start);
                    res.period_startYear = formatDateYear(period_start);

                    initialDataHTML += Mustache.render(templateContent, { Encounter: [res] });
                }
                else if (res.resourceType === "MedicationRequest") {
                    var authoredOn = new Date(res.authoredOn ?? res.meta?.lastUpdated);
                    res.authoredOntime = formatDate(authoredOn);
                    res.authoredOnYear = formatDateYear(authoredOn);

                    initialDataHTML += Mustache.render(templateContent, { MedicationRequest: [res] });
                }
                else if (res.resourceType === "Procedure") {
                    var performedPeriod_start = new Date(res.performedPeriod != null ? (res.performedPeriod.start ?? res.meta?.lastUpdated) : res.meta?.lastUpdated);
                    var performedPeriod_end = new Date(res.performedPeriod != null ? (res.performedPeriod.end ?? res.meta?.lastUpdated) : res.meta?.lastUpdated);
                    res.performedPeriod_startTime = formatDate(performedPeriod_start);
                    res.performedPeriod_startYear = formatDateYear(performedPeriod_start);
                    res.performedPeriod_endTime = formatDate(performedPeriod_end);
                    res.performedPeriod_endYear = formatDateYear(performedPeriod_end);

                    initialDataHTML += Mustache.render(templateContent, { Procedure: [res] });
                }
                else if (res.resourceType === "Condition") {
                    var onsetDateTime = new Date(res.onsetDateTime ?? res.meta.lastUpdated);
                    res.onsetDateTimetime = formatDate(onsetDateTime);
                    res.onsetDateTimeYear = formatDateYear(onsetDateTime);

                    initialDataHTML += Mustache.render(templateContent, { Condition: [res] });
                }
                else if (res.resourceType === "Composition") {
                    let date = new Date(res.date ?? res.meta?.lastUpdated);
                    res.datetime = formatDate(date);
                    res.dateYear = formatDateYear(date);

                    initialDataHTML += Mustache.render(templateContent, { Composition: [res] });
                }
            });
            $('#data-container').append(initialDataHTML);


            if (resourcesJson.length === 0) {
                return;
            }
        }



        function ClickDiv() {
            $(".timeline-label").click(function () {
                a_element = $("a[href='" + $(location).attr("pathname") + "']").offset();
                if (a_element.top < 0) {
                    a_element.top = -a_element.top;
                }
                localStorage.setItem("url", a_element.top);
            });
        }
        //點擊定位
        function TimeLableClick() {
            $(".timeline-label").click(function () {
                //recalculateOffset(HTML1);
                let posX = $(".timeline-label").offset().left,
                    posY = $(".timeline-label").offset().top;
                console.log(", " + posY)
                if (posY < 0) {
                    posY -= 100;
                    posY = -posY;
                }
                else {
                    posY += 100;
                }
                localStorage.setItem('position', posY);

            });
        }



        //更改Patient和Composition樣式
        function Composition_chang_class() {
            let currentURL = window.location.href;
            let segments = currentURL.split("/");
            let compositionValue = segments[segments.length - 1];
            console.log(currentURL.split('=').slice(1)[0]);
            if (isbundle == true) {
                if (currentURL.split('=').slice(1)[0] == "Composition&id") {
                    localStorage.setItem('position', 0);
                }
                $('#PatFirst').addClass('fa-ground');
                $('#PatFirst').removeClass('fa-exclamation');
                $('#CompFirst').addClass('fa-exclamation');
                $('#CompFirst').removeClass('fa-ground');
            }
            else {
                $('#CompFirst').addClass('fa-ground');
                $('#CompFirst').removeClass('fa-exclamation');
                $('#PatFirst').addClass('fa-exclamation');
                $('#PatFirst').removeClass('fa-ground');
            }
        }

        var numposition = 0;
        var foundTargetElement = false;
        function scrollToElement(position) {//自動滑動-修改中
            console.log(position);
            if (position === null || typeof position === "undefined") {
                // 如果 a_element 为 null 或未定义，则每次滑动事件将滚动位置增加 1000
                numposition += 1000;
                $('#time_line').animate({
                    scrollTop: numposition
                }, 500, function () {
                    if (!foundTargetElement) {
                        scrollToElement(); // 递归调用，继续检查满足条件
                    }
                });
            } else {
                console.log("OK");
                position = position.top
                if (has = 0) {
                    position += 1700;
                }
                else {
                    console.log("22");
                    position -= 200;
                }
                $('#time_line').animate({
                    scrollTop: position
                });

                // 设置标志为 true，表示已经找到目标元素
                foundTargetElement = true;
            }
        }

        // 時間格式
        function AgeResult(data) {//歲數
            let birthday;
            let age = -1;
            let now = new Date();

            if (data != null) {
                birthday = new Date(data);
                age = now.getFullYear() - birthday.getFullYear();
                if (now < new Date(now.getFullYear(), birthday.getMonth(), birthday.getDate())) {
                    age--;
                }
            }
            if (age === -1) {
                return "未知";
            }
            else {
                return age;
            }

        }

        function formatDate(date) {
            if (data = 0) {
                return "";
            }
            else {
                var hours = date.getHours();
                var minutes = date.getMinutes();
                var ampm = hours >= 12 ? '下午' : '上午';

                // 调整小时和分钟的格式，确保为两位数
                hours = hours % 12;
                hours = hours ? hours : 12; // 如果小时为0，则设置为12
                minutes = minutes < 10 ? '0' + minutes : minutes;

                var formattedDate = ampm + ' ' + hours + ':' + minutes;
                return formattedDate;
            }
        }

        function formatDateYear(date) {
            if (!date) {
                return "";
            } else {
                var year = date.getFullYear();
                var month = date.getMonth() + 1; // 月份从0开始，需要加1
                var day = date.getDate();

                // 调整月份和日期的格式，确保为两位数
                month = month < 10 ? '0' + month : month;
                day = day < 10 ? '0' + day : day;

                var formattedDate = year + '年' + month + '月' + day + '日';
                return formattedDate;
            }
        }

        //懶載入修改中
        @* $("#btn").on("click", function () {
            var scrollPosition = 0;
            var unitSize = 900;
            // 初始載入，載入十筆資料
            $.ajax({
                //url: "/Resource/GetData",
                url: "@Url.Action("Index", "Resource")?isbundle=false",
                type: "POST",
                data: { scrollPosition: scrollPosition, isInitialLoad: true },
                success: function (data123) {
                    console.log("data:");
                    console.log(data123);

                    // 將初始載入的資料插入到主HTML的容器元素中
                    //$("#data-container").html(data);
                    //scrollPosition += unitSize; // 更新滑動位置
                },

                error: function (xhr, status, error) {
                    console.log("發生錯誤:", error);
                    console.log("6");

                }
         });


        function recalculateOffset() {
            //console.log("this",initialDataHTML);
            var a_element = $("a[href='" + $(location).attr("pathname") + "']").offset();
            console.log("元素:", a_element)
            a_element.top -= 200;
            $('#time_line').animate({
                scrollTop: a_element.top
            });
        }

        $(".footer").remove();

        $("#cutomerTable").DataTable({
            "scrollY": "200px",
            "scrollCollapse": true,
            "searching": false, //搜尋功能, 預設是開啟
            "paging": false, //分頁功能, 預設是開啟
            "ordering": true //排序功能, 預設是開啟
        });
        // Define data
        var data = @Html.Raw(JsonConvert.SerializeObject(chart_data));
        $("#chartdiv").css({ "height": "0px" });
        //console.log(data.length);
        if (data.length > 0) {
            $("#chartdiv").css({ "height": "300px" });
            // Create root and chart
            var root = am5.Root.new("chartdiv");

            root.setThemes([
                am5themes_Animated.new(root)
            ]);

            var chart = root.container.children.push(
                am5xy.XYChart.new(root, {
                    panY: false,
                    wheelY: "zoomX",
                    layout: root.verticalLayout,
                    maxTooltipDistance: 0
                })
            );

            // Create Y-axis
            var yAxis = chart.yAxes.push(
                am5xy.ValueAxis.new(root, {
                    extraTooltipPrecision: 1,
                    renderer: am5xy.AxisRendererY.new(root, {})
                })
            );

            // Create X-Axis
            let xAxis = chart.xAxes.push(
                am5xy.DateAxis.new(root,
                    {
                        baseInterval: {
                            timeUnit: "day",
                            count: 1
                        },
                        extraMax: 0.05,
                        extraMin: 0.05,
                        renderer: am5xy.AxisRendererX.new(root, {})
                    })
            );

            xAxis.get("dateFormats")["day"] = "yyyy-MM-dd";
            xAxis.get("periodChangeDateFormats")["day"] = "MMMM";

            // Create series
            function createSeries(name, field) {
                var series = chart.series.push(
                    am5xy.LineSeries.new(root, {
                        name: name,
                        xAxis: xAxis,
                        yAxis: yAxis,
                        valueYField: field,
                        valueXField: "date",
                        tooltip: am5.Tooltip.new(root, {})
                    })
                );

                series.bullets.push(function () {
                    return am5.Bullet.new(root, {
                        sprite: am5.Circle.new(root, {
                            radius: 5,
                            fill: series.get("fill"),
                            stroke: root.interfaceColors.get("background"),
                            strokeWidth: 2,
                            tooltipText: "[bold]{valueX.formatDate()}[/]\n[bold]Value:[/] {valueY}",
                            showTooltipOn: "always",
                        })
                    });
                });

                series.strokes.template.set("strokeWidth", 2);

                series.data.processor = am5.DataProcessor.new(root, {
                    dateFormat: "yyyy-MM-dd",
                    dateFields: ["date"]
                });

                series.data.setAll(data);
            }

            createSeries("Series", "value");

            // Add cursor
            chart.set("cursor", am5xy.XYCursor.new(root, {
                behavior: "zoomXY",
                xAxis: xAxis
            }));

            xAxis.set("tooltip", am5.Tooltip.new(root, {
                themeTags: ["axis"]
            }));

            yAxis.set("tooltip", am5.Tooltip.new(root, {
                themeTags: ["axis"]
            }));

        }

        //alert('location.pathname: ' + location.pathname);
        var selepath = location.pathname;
        var indexOfFirst = selepath.indexOf("Resource/");
        var st = selepath.substring(indexOfFirst + 9)
        var indexOftwo = st.indexOf("/");
        var st1 = st.substring(-1,indexOftwo)
        //alert("st1=" + st1);

        ////selec預設
        //$("#ResourceSelect").val(st1);


        //select事件
        @*$("#ResourceSelect").on('change', function () {
            var sele = $(this).val().toString();
            //alert(sele);
            var pat_id = $("#Patient_id").val();
            var data = Getdata();
            var baseSiteURL = '@Url.Content("~/")';
            $.ajax({
                "url": "@Url.Action("Index", "Resource")",
                "type": "POST",
                "data": data,
                "datatype": "json",
                "success": function (msg) {
                    var s = eval("(" + msg + ")");
                    //alert(msg);
                    if (sele == "Patient") {
                        //alert("我是pat")
                        console.log(s[0].resourceType);
                        //alert("resourceType:" + JSON.stringify(s[1].resourceType) + "id:" + JSON.stringify(s[1].id));
                        var resourceType = JSON.stringify(s[0].resourceType).replace('"', '');
                        var resourceType1 = resourceType.replace('"', '');
                        //alert(resourceType1);
                        var resourceTypeid = JSON.stringify(s[0].id).replace('"', '');
                        var resourceTypeid1 = resourceTypeid.replace('"', '');
                        //alert(resourceTypeid1);
                        //alert("哈囉~");//請求成功後執行的操作 alert(msg);

                        //alert("成功~");
                        var a = baseSiteURL + 'Resource/' + resourceType1 + '/' + resourceTypeid1;
                        //alert(a);
                        window.location.href = a;
                    }
                    else if (s[1] == null) {
                        alert("找不到任何相關資料");
                    }
                    else if (s[1] != null){
                        console.log(s[1].resourceType);
                        //alert("resourceType:" + JSON.stringify(s[1].resourceType) + "id:" + JSON.stringify(s[1].id));
                        var resourceType = JSON.stringify(s[1].resourceType).replace('"', '');
                        var resourceType1 = resourceType.replace('"', '');
                        //alert(resourceType1);
                        var resourceTypeid = JSON.stringify(s[1].id).replace('"', '');
                        var resourceTypeid1 = resourceTypeid.replace('"', '');
                        //alert(resourceTypeid1);
                        //alert("哈囉~");//請求成功後執行的操作 alert(msg);

                        //alert("成功~");
                        var a = baseSiteURL + 'Resource/' + resourceType1 + '/' + resourceTypeid1;
                        //alert(a);
                        window.location.href = a;
                    }



                }
            });
            function Getdata() {
                var data = {};
                data.res = "Patient";
                data.id = $("#Patient_id").val();
                data.sele = sele;
                /*data.resource = $("#ResourceSelect").val();*/
                return data;
            }
        });*@


</script>
}

